# ==================================================
# Path: D:\NextJs\v2\project-email-customize\frontend
# Detected tech: javascript, python, react, typescript
# ==================================================

## DIRECTORY STRUCTURE
```
frontend/
├── .next/
├── app/
│   ├── (auth)/
│   │   ├── callback/
│   │   │   └── page.tsx
│   │   ├── login/
│   │   │   └── page.tsx
│   │   ├── register/
│   │   │   └── page.tsx
│   │   └── layout.tsx
│   ├── inbox/
│   │   └── page.tsx
│   ├── kanban/
│   │   ├── layout.tsx
│   │   └── page.tsx
│   ├── favicon.ico
│   ├── globals.css
│   ├── layout.tsx
│   ├── page.tsx
│   └── provider.tsx
├── components/
│   ├── layout/
│   │   ├── AppShell.tsx
│   │   └── SideBar.tsx
│   ├── ui/
│   │   ├── ComposeModal.tsx
│   │   ├── ForwardModal.tsx
│   │   ├── Kanban.tsx
│   │   ├── MailBox.tsx
│   │   ├── MailContent.tsx
│   │   ├── ThemeSwicher.tsx
│   │   ├── button.tsx
│   │   ├── card.tsx
│   │   ├── input.tsx
│   │   └── label.tsx
│   ├── auth-initializer.tsx
│   ├── logout-button.tsx
│   ├── theme-provider.js
│   └── theme-switcher.tsx
├── contexts/
│   ├── ThemeContext.tsx
│   ├── auth-context.tsx
│   └── ui-context.tsx
├── hooks/
│   ├── useGoogleLoginMutation.ts
│   ├── useLoginMutation.ts
│   ├── useLogoutMutation.ts
│   ├── useRegisterMutation.ts
│   └── useUserQuery.ts
├── lib/
├── mockDatas/
│   └── index.ts
├── node_modules/
├── public/
│   ├── file.svg
│   ├── globe.svg
│   ├── next.svg
│   ├── vercel.svg
│   └── window.svg
├── types/
│   ├── auth.types.ts
│   └── index.ts
├── utils/
│   └── MailClassify.ts
├── .env.local
├── .gitignore
├── README.md
├── a.html
├── components.json
├── eslint.config.mjs
├── middleware.ts
├── next-env.d.ts
├── next.config.ts
├── package-lock.json
├── package.json
├── postcss.config.mjs
└── tsconfig.json
```

## FILE CONTENTS

### eslint.config.mjs
```mjs
import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";

const eslintConfig = defineConfig([
  ...nextVitals,
  ...nextTs,
  // Override default ignores of eslint-config-next.
  globalIgnores([
    // Default ignores of eslint-config-next:
    ".next/**",
    "out/**",
    "build/**",
    "next-env.d.ts",
  ]),
]);

export default eslintConfig;

```

### middleware.ts
```ts
import { NextResponse } from 'next/server';
import type { NextRequest } from 'next/server';

// ========================================
// MIDDLEWARE - DISABLED FOR IN-MEMORY TOKENS
// ========================================
// Since access tokens are now stored in-memory only (not in cookies),
// middleware cannot check authentication state.
// Auth protection is handled client-side in page components via useUserQuery.
// ========================================

export function middleware(request: NextRequest) {
  // Allow all requests - auth protection handled client-side
  // Client-side protection:
  // 1. useUserQuery checks accessToken in AuthContext
  // 2. If no token, tries to refresh from HttpOnly cookie
  // 3. If refresh fails, redirects to login
  return NextResponse.next();
}

// Configure which routes should trigger the middleware
export const config = {
  matcher: [
    /*
     * Match all request paths except:
     * - api (API routes)
     * - _next/static (static files)
     * - _next/image (image optimization files)
     * - favicon.ico (favicon file)
     * - public files (public folder)
     */
    '/((?!api|_next/static|_next/image|favicon.ico|.*\\..*|public).*)',
  ],
};

```

### next-env.d.ts
```ts
/// <reference types="next" />
/// <reference types="next/image-types/global" />
import "./.next/dev/types/routes.d.ts";

// NOTE: This file should not be edited
// see https://nextjs.org/docs/app/api-reference/config/typescript for more information.

```

### next.config.ts
```ts
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  /* config options here */
};

export default nextConfig;

```

### postcss.config.mjs
```mjs
const config = {
  plugins: {
    "@tailwindcss/postcss": {},
  },
};

export default config;

```

### app\layout.tsx
```tsx
import type { Metadata } from "next";
import { Geist, Geist_Mono } from "next/font/google";
import "./globals.css";
import ThemeProviders from "@/components/theme-provider";
import { AuthProvider } from "@/contexts/auth-context";
import { UIProvider } from "@/contexts/ui-context"; // Import mới
import { AuthInitializer } from "@/components/auth-initializer";
import { GoogleOAuthProvider } from "@react-oauth/google";
import AppShell from "@/components/layout/AppShell";

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});

export const metadata: Metadata = {
  title: "Email Customize",
  description: "Email customization and management application",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  const googleClientId = process.env.NEXT_PUBLIC_GOOGLE_CLIENT_ID || "";

  return (
    <html lang="en">
      <body
        className={`${geistSans.variable} ${geistMono.variable} antialiased`}
      >
        <GoogleOAuthProvider clientId={googleClientId}>
          <ThemeProviders attribute="class" defaultTheme="system" enableSystem>
            <AuthProvider>
              {" "}
              {/* Bọc UIProvider */}
              <AuthInitializer>
                {" "}
                {/* Bọc AppShell để hiển thị Sidebar */}
                {children}
              </AuthInitializer>
            </AuthProvider>
          </ThemeProviders>
        </GoogleOAuthProvider>
      </body>
    </html>
  );
}

```

### app\page.tsx
```tsx
"use client"

import Link from "next/link";
import { Mail, Shield, Zap, Users, ArrowRight, Check } from "lucide-react";
import { Button } from "@/components/ui/button";
import ThemeSwitcher from "@/components/theme-switcher";
import LogoutButton from "@/components/logout-button";
import { useEffect } from "react";
import { useRouter, useSearchParams } from "next/navigation";
import { useAuth } from "@/contexts/auth-context";

export default function Welcome() {
  const router = useRouter();
  const searchParams = useSearchParams();
  const { user, isAuthenticated } = useAuth();

  useEffect(() => {
    const authStatus = searchParams.get('auth');
    
    if (authStatus === 'success') {
      // Redirect to callback page for processing
      router.push('/callback?auth=success');
    }
  }, [searchParams, router]);

  return (
    <div className="min-h-screen bg-linear-to-b from-zinc-50 to-white dark:from-zinc-950 dark:to-zinc-900">
      {/* Header / Navigation */}
      <header className="border-b border-zinc-200 dark:border-zinc-800 bg-white/50 dark:bg-zinc-900/50 backdrop-blur-sm sticky top-0 z-50">
        <div className="container mx-auto px-4 sm:px-6 lg:px-8">
          <div className="flex h-16 items-center justify-between">
            <div className="flex items-center gap-2">
              <Mail className="h-6 w-6 text-blue-600 dark:text-blue-500" />
              <span className="text-xl font-bold text-zinc-900 dark:text-zinc-50">
                Email Customize
              </span>
            </div>
            <div className="flex items-center gap-4">
              <ThemeSwitcher />
              {isAuthenticated && user ? (
                <>
                  <span className="text-sm text-zinc-700 dark:text-zinc-300 hidden sm:inline">
                    {user.name || user.email}
                  </span>
                  <LogoutButton />
                </>
              ) : (
                <>
                  <Link href="/login">
                    <Button variant="outline" size="sm">
                      Sign in
                    </Button>
                  </Link>
                  <Link href="/register">
                    <Button size="sm" className="hidden sm:flex">
                      Sign up
                    </Button>
                  </Link>
                </>
              )}
            </div>
          </div>
        </div>
      </header>

      {/* Hero Section */}
      <section className="container mx-auto px-4 sm:px-6 lg:px-8 pt-20 pb-16 md:pt-32 md:pb-24">
        <div className="flex flex-col items-center text-center gap-8 max-w-4xl mx-auto">
          {/* Badge */}
          <div className="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-blue-50 dark:bg-blue-950/30 border border-blue-200 dark:border-blue-800">
            <Zap className="h-4 w-4 text-blue-600 dark:text-blue-400" />
            <span className="text-sm font-medium text-blue-700 dark:text-blue-300">
              AI-Powered Email Management
            </span>
          </div>

          {/* Main Heading */}
          <h1 className="text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-bold tracking-tight text-zinc-900 dark:text-zinc-50">
            Email Management
            <span className="block text-blue-600 dark:text-blue-500 mt-2">
              Made Simple
            </span>
          </h1>

          {/* Description */}
          <p className="text-lg sm:text-xl text-zinc-600 dark:text-zinc-400 max-w-2xl leading-relaxed">
            Organize, customize, and manage your emails with our powerful dashboard. 
            Built with modern technology to save you time and boost productivity.
          </p>

          {/* CTA Buttons */}
          <div className="flex flex-col sm:flex-row gap-4 mt-4">
            <Link href={isAuthenticated ? "/inbox" : "/login"}>
              <Button size="lg" className="text-base px-8">
                {isAuthenticated ? "Go to Inbox" : "Get Started"}
              </Button>
            </Link>
          </div>

        </div>
      </section>

      {/* Features Section */}
      <section className="container mx-auto px-4 sm:px-6 lg:px-8 py-16 md:py-24">
        <div className="text-center mb-16">
          <h2 className="text-3xl md:text-4xl font-bold text-zinc-900 dark:text-zinc-50 mb-4">
            Everything you need to manage emails
          </h2>
          <p className="text-lg text-zinc-600 dark:text-zinc-400 max-w-2xl mx-auto">
            Powerful features to help you organize, customize, and streamline your email workflow.
          </p>
        </div>

        <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-8 max-w-6xl mx-auto">
          {/* Feature 1 */}
          <div className="p-6 rounded-xl border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900 hover:shadow-lg transition-shadow">
            <div className="h-12 w-12 rounded-lg bg-blue-100 dark:bg-blue-950/30 flex items-center justify-center mb-4">
              <Mail className="h-6 w-6 text-blue-600 dark:text-blue-500" />
            </div>
            <h3 className="text-xl font-semibold text-zinc-900 dark:text-zinc-50 mb-2">
              Smart Inbox
            </h3>
            <p className="text-zinc-600 dark:text-zinc-400">
              Organize your emails with intelligent folders, filters, and custom labels for better productivity.
            </p>
          </div>

          {/* Feature 2 */}
          <div className="p-6 rounded-xl border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900 hover:shadow-lg transition-shadow">
            <div className="h-12 w-12 rounded-lg bg-green-100 dark:bg-green-950/30 flex items-center justify-center mb-4">
              <Shield className="h-6 w-6 text-green-600 dark:text-green-500" />
            </div>
            <h3 className="text-xl font-semibold text-zinc-900 dark:text-zinc-50 mb-2">
              Secure Authentication
            </h3>
            <p className="text-zinc-600 dark:text-zinc-400">
              Login with email/password or Google Sign-In. Your data is protected with enterprise-grade security.
            </p>
          </div>

          {/* Feature 3 */}
          <div className="p-6 rounded-xl border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900 hover:shadow-lg transition-shadow">
            <div className="h-12 w-12 rounded-lg bg-purple-100 dark:bg-purple-950/30 flex items-center justify-center mb-4">
              <Zap className="h-6 w-6 text-purple-600 dark:text-purple-500" />
            </div>
            <h3 className="text-xl font-semibold text-zinc-900 dark:text-zinc-50 mb-2">
              Lightning Fast
            </h3>
            <p className="text-zinc-600 dark:text-zinc-400">
              Built with Next.js 16 for blazing-fast performance and seamless user experience.
            </p>
          </div>

          {/* Feature 4 */}
          <div className="p-6 rounded-xl border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900 hover:shadow-lg transition-shadow">
            <div className="h-12 w-12 rounded-lg bg-orange-100 dark:bg-orange-950/30 flex items-center justify-center mb-4">
              <Users className="h-6 w-6 text-orange-600 dark:text-orange-500" />
            </div>
            <h3 className="text-xl font-semibold text-zinc-900 dark:text-zinc-50 mb-2">
              Collaboration
            </h3>
            <p className="text-zinc-600 dark:text-zinc-400">
              Share and collaborate on emails with your team members efficiently.
            </p>
          </div>

          {/* Feature 5 */}
          <div className="p-6 rounded-xl border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900 hover:shadow-lg transition-shadow">
            <div className="h-12 w-12 rounded-lg bg-pink-100 dark:bg-pink-950/30 flex items-center justify-center mb-4">
              <svg className="h-6 w-6 text-pink-600 dark:text-pink-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" />
              </svg>
            </div>
            <h3 className="text-xl font-semibold text-zinc-900 dark:text-zinc-50 mb-2">
              Customizable
            </h3>
            <p className="text-zinc-600 dark:text-zinc-400">
              Personalize your email dashboard with themes, layouts, and custom settings.
            </p>
          </div>

          {/* Feature 6 */}
          <div className="p-6 rounded-xl border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900 hover:shadow-lg transition-shadow">
            <div className="h-12 w-12 rounded-lg bg-indigo-100 dark:bg-indigo-950/30 flex items-center justify-center mb-4">
              <svg className="h-6 w-6 text-indigo-600 dark:text-indigo-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
              </svg>
            </div>
            <h3 className="text-xl font-semibold text-zinc-900 dark:text-zinc-50 mb-2">
              Responsive Design
            </h3>
            <p className="text-zinc-600 dark:text-zinc-400">
              Works seamlessly on desktop, tablet, and mobile devices with adaptive layouts.
            </p>
          </div>
        </div>
      </section>

      {/* Footer */}
      <footer className="border-t border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900">
        <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
          <div className="flex flex-col md:flex-row justify-between items-center gap-6">
            <div className="flex items-center gap-2">
              <Mail className="h-5 w-5 text-blue-600 dark:text-blue-500" />
              <span className="font-semibold text-zinc-900 dark:text-zinc-50">
                Email Customize
              </span>
            </div>
            <p className="text-sm text-zinc-600 dark:text-zinc-400">
              © 2025 Email Customize. All rights reserved.
            </p>
            <div className="flex gap-6 text-sm text-zinc-600 dark:text-zinc-400">
              <a href="#" className="hover:text-zinc-900 dark:hover:text-zinc-50 transition-colors">
                Privacy
              </a>
              <a href="#" className="hover:text-zinc-900 dark:hover:text-zinc-50 transition-colors">
                Terms
              </a>
              <a href="#" className="hover:text-zinc-900 dark:hover:text-zinc-50 transition-colors">
                Contact
              </a>
            </div>
          </div>
        </div>
      </footer>
    </div>
  );
}

```

### app\provider.tsx
```tsx
"use client";
import { useState, useEffect } from "react";
import { useTheme } from "next-themes";

const ThemeSwitch = () => {
  const [mounted, setMounted] = useState(false);
  const { theme, setTheme } = useTheme();

  // useEffect only runs on the client, so now we can safely show the UI
  useEffect(() => {
    setMounted(true);
  }, []);

  if (!mounted) {
    return null;
  }

  return (
    <select value={theme} onChange={(e) => setTheme(e.target.value)}>
      <option value="system">System</option>
      <option value="dark">Dark</option>
      <option value="light">Light</option>
    </select>
  );
};

export default ThemeSwitch;

```

### app\(auth)\layout.tsx
```tsx
"use client";

import { useAuth } from "@/contexts/auth-context";
import ThemeSwitcher from "@/components/theme-switcher";

export default function AuthLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  const { isLoading } = useAuth();

  return (
    <div className="flex relative w-full min-h-screen items-center justify-center bg-zinc-50 dark:bg-zinc-900">
      {isLoading ? (
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"></div>
          <p className="mt-4 text-sm text-muted-foreground">Loading...</p>
        </div>
      ) : (
        <>
          {children}

          {/* ThemeSwitcher component to toggle light/dark themes */}
          <div className="absolute bottom-0 left-0 m-4">
            <ThemeSwitcher />
          </div>
        </>
      )}
    </div>
  );
}

```

### app\(auth)\callback\page.tsx
```tsx
"use client"

import { useEffect, useState } from 'react';
import { useRouter, useSearchParams } from 'next/navigation';
import { useAuth } from '@/contexts/auth-context';
import { setAccessToken } from '@/lib/token';

export default function AuthCallback() {
  const router = useRouter();
  const searchParams = useSearchParams();
  const { setUser, setIsAuthenticated } = useAuth();
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    const handleCallback = async () => {
      const authStatus = searchParams.get('auth');
      
      if (authStatus === 'success') {
        try {
          const backendUrl = process.env.NEXT_PUBLIC_BACKEND_API_URL || 'http://localhost:5000';
          
          // Call /auth/refresh to get accessToken (refreshToken is in HttpOnly cookie)
          const refreshResponse = await fetch(`${backendUrl}/auth/refresh`, {
            method: 'POST',
            credentials: 'include', // Send cookies
            headers: {
              'Content-Type': 'application/json'
            }
          });
          
          if (!refreshResponse.ok) {
            throw new Error('Failed to refresh token');
          }
          
          const { accessToken } = await refreshResponse.json();
          
          // Store accessToken
          setAccessToken(accessToken);
          
          // Fetch user info
          const userResponse = await fetch(`${backendUrl}/users/me`, {
            headers: {
              'Authorization': `Bearer ${accessToken}`
            },
            credentials: 'include'
          });
          
          if (userResponse.ok) {
            const userData = await userResponse.json();
            const userObj = userData.user || userData;
            
            // Set user and authenticated state
            setUser(userObj);
            setIsAuthenticated(true);
            
            console.log('Callback - User authenticated:', userObj);
            router.push('/inbox');
          } else {
            setError('Failed to fetch user information');
          }
        } catch (err) {
          console.error('Callback error:', err);
          setError('Authentication failed: ' + (err instanceof Error ? err.message : 'Unknown error'));
        }
      } else if (authStatus === 'error') {
        setError(searchParams.get('message') || 'Authentication failed');
      } else {
        setError('Invalid callback - missing auth status');
      }
    };

    handleCallback();
  }, [searchParams, router, setUser]);

  if (error) {
    return (
      <div className="flex min-h-screen items-center justify-center bg-zinc-50 dark:bg-zinc-900">
        <div className="text-center">
          <h1 className="text-2xl font-bold text-red-600 mb-4">Authentication Error</h1>
          <p className="text-zinc-600 dark:text-zinc-400 mb-4">{error}</p>
          <button
            onClick={() => router.push('/login')}
            className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
          >
            Back to Login
          </button>
        </div>
      </div>
    );
  }

  return (
    <div className="flex min-h-screen items-center justify-center bg-zinc-50 dark:bg-zinc-900">
      <div className="text-center">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
        <p className="text-zinc-600 dark:text-zinc-400">Completing authentication...</p>
      </div>
    </div>
  );
}

```

### app\(auth)\login\page.tsx
```tsx
"use client"

import { Button } from "@/components/ui/button"
import {
  Card,
  CardContent,
  CardDescription,
  CardFooter,
  CardHeader,
  CardTitle,
} from "@/components/ui/card"
import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"
import { useForm } from "react-hook-form"
import { z } from "zod"
import { zodResolver } from "@hookform/resolvers/zod"
import Link from "next/link"
import { useLoginMutation } from "@/hooks/useLoginMutation"
import { useGoogleLoginMutation } from "@/hooks/useGoogleLoginMutation"
import { useGoogleLogin as useGoogleOAuth } from '@react-oauth/google'
import { Mail, Eye, EyeOff } from "lucide-react"
import { useState } from "react"

// Define a schema for form validation
const loginSchema = z.object({
  email: z.string().email("Please enter a valid email"),
  password: z.string().min(1, "Password is required"),
})

// Define the form data type based on the schema
type LoginData = z.infer<typeof loginSchema>;

export default function Login() {
  // Use custom hook for login logic
  const { login, isLoading, error: loginError } = useLoginMutation();
  const { loginWithGoogle, isLoading: isGoogleLoading, error: googleError } = useGoogleLoginMutation();
  const [googleCode, setGoogleCode] = useState<string | null>(null);
  const [showPassword, setShowPassword] = useState(false);

  // Set up the form with react-hook-form and zod validation
  const {
    register,
    handleSubmit,
    formState: { errors },
  } = useForm<LoginData>({
    resolver: zodResolver(loginSchema),
  });

  // Define the form submission handler
  const onSubmit = async (data: LoginData) => {
    try {
      await login(data);
      // Navigation handled by hook
    } catch (error) {
      // Error handled by hook
    }
  };

  // Google OAuth (client-side request for Authorization Code)
  const googleOAuth = useGoogleOAuth({
    flow: 'auth-code',
    scope: 'openid email profile https://www.googleapis.com/auth/gmail.readonly https://www.googleapis.com/auth/gmail.modify https://www.googleapis.com/auth/gmail.send',
    onSuccess: async (resp: any) => {
      try {
        const code = resp?.code;
        if (!code) throw new Error('No authorization code received from Google');
        // Save code to state for debugging/verification in dev
        setGoogleCode(code);
        await loginWithGoogle(code);
      } catch (err) {
        // error state is handled by the mutation hook; console for debugging
        console.error('Google login failed:', err);
      }
    },
    onError: (err: any) => {
      console.error('Google SDK error', err);
    }
  });

  // Google OAuth redirect handler
  // const handleGoogleLogin = () => {
  //   // Redirect to backend OAuth endpoint
  //   const backendUrl = process.env.NEXT_PUBLIC_BACKEND_API_URL || 'http://localhost:5000';
  //   window.location.href = `${backendUrl}/auth/google`;
  // };

  const isAnyLoading = isLoading;
  const displayError = loginError;

  return (
    // THAY ĐỔI 1: Nền tổng thể chuyển sang gray-50 ở Light mode để tạo độ tương phản với Card trắng
    <div className="relative w-full min-h-screen flex flex-col items-center justify-center overflow-hidden bg-gray-50 dark:bg-zinc-950 transition-colors duration-300">

      {/* --- LỚP NỀN (BACKGROUND DECOR) --- */}
      <div className="absolute inset-0 z-0 h-full w-full">
        {/* THAY ĐỔI 2: Grid Pattern đậm hơn ở Light mode (#0000000p - độ trong suốt cao hơn) */}
        <div className="absolute h-full w-full bg-[linear-gradient(to_right,#00000008_1px,transparent_1px),linear-gradient(to_bottom,#00000008_1px,transparent_1px)] dark:bg-[linear-gradient(to_right,#8080800a_1px,transparent_1px),linear-gradient(to_bottom,#8080800a_1px,transparent_1px)] bg-[size:24px_24px]"></div>

        {/* THAY ĐỔI 3: Glow Effect - Light mode dùng màu Cyan/Blue đậm hơn một chút để thấy rõ trên nền trắng */}
        <div className="absolute left-0 right-0 top-0 -z-10 m-auto h-[350px] w-[350px] rounded-full bg-blue-400/20 blur-[80px] dark:bg-blue-600/20 dark:blur-[100px]"></div>
      </div>

      {/* --- HEADER --- */}
      <header className="absolute top-0 z-50 w-full">
        <div className="container mx-auto px-4 sm:px-6 lg:px-8">
          <div className="flex h-16 items-center justify-between">
            <div className="flex items-center gap-2">
              <Mail className="h-6 w-6 text-blue-600 dark:text-blue-500 align-middle" />
              {/* Text color tự động chuyển đổi */}
              <Link href="/" className="text-xl font-bold text-zinc-900 dark:text-zinc-50 leading-none">
                Email Customize
              </Link>
            </div>
          </div>
        </div>
      </header>



      {/* --- CARD LOGIN CHÍNH --- */}
      <div className="z-10 w-full px-4 flex justify-center">
        {/* THAY ĐỔI 4: Card Style
            - Light: bg-white (ko trong suốt) + shadow lớn để tách biệt hẳn với nền
            - Dark: bg-white/5 (trong suốt) + backdrop-blur
        */}
        <Card className="w-full max-w-md 
          bg-white shadow-[0_8px_30px_rgb(0,0,0,0.04)] border-zinc-100 
          dark:bg-zinc-900/60 dark:backdrop-blur-xl dark:border-zinc-800 dark:shadow-2xl">

          <CardHeader className="space-y-1">
            <CardTitle className="text-2xl font-bold text-center text-zinc-900 dark:text-zinc-50">Login</CardTitle>
            <CardDescription className="text-center text-zinc-500 dark:text-zinc-400">
              Hi, Enter your email and password to access your account
            </CardDescription>
          </CardHeader>

          <CardContent>
            <form onSubmit={handleSubmit(onSubmit)}>
              {/* Error Alert */}
              {displayError && (
                <div className="mb-4 p-3 rounded-md bg-red-50 border border-red-100 dark:bg-red-900/20 dark:border-red-800 flex items-center gap-2">
                  <div className="h-2 w-2 rounded-full bg-red-500 shrink-0" />
                  <p className="text-red-600 dark:text-red-400 text-sm font-medium">{displayError}</p>
                </div>
              )}

              <div className="flex flex-col gap-5">
                <div className="grid gap-2">
                  <Label htmlFor="email" className="text-zinc-700 dark:text-zinc-300">Email</Label>
                  <Input
                    id="email"
                    type="email"
                    placeholder="name@example.com"
                    {...register("email")}
                    disabled={isAnyLoading}
                    // Input ở Light mode cần border rõ hơn một chút
                    className="bg-zinc-50 border-zinc-200 focus:bg-white transition-all dark:bg-zinc-950/50 dark:border-zinc-800"
                    required
                  />
                  {errors.email && <p className="text-red-500 text-sm">{errors.email.message}</p>}
                </div>

                <div className="grid gap-2">
                  <div className="flex items-center">
                    <Label htmlFor="password" className="text-zinc-700 dark:text-zinc-300">Password</Label>
                    <a
                      href="#"
                      className="ml-auto text-sm font-medium text-blue-600 hover:text-blue-500 dark:text-blue-400"
                    >
                      Forgot password?
                    </a>
                  </div>
                  <div className="relative">
                    <Input
                      id="password"
                      placeholder="••••••••"
                      type={showPassword ? "text" : "password"}
                      autoComplete="current-password"
                      {...register("password")}
                      disabled={isAnyLoading}
                      className="bg-zinc-50 border-zinc-200 focus:bg-white transition-all dark:bg-zinc-950/50 dark:border-zinc-800 pr-10"
                      required
                    />
                    <button
                      type="button"
                      onClick={() => setShowPassword(!showPassword)}
                      className="absolute right-3 top-1/2 -translate-y-1/2 text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200"
                    >
                      {showPassword ? <EyeOff className="h-4 w-4" /> : <Eye className="h-4 w-4" />}
                    </button>
                  </div>
                  {errors.password && <p className="text-red-500 text-sm">{errors.password.message}</p>}
                </div>
              </div>

              <Button type="submit" className="w-full mt-6 bg-blue-600 hover:bg-blue-700 text-white font-medium shadow-sm dark:shadow-blue-900/20" disabled={isAnyLoading}>
                {isLoading ? 'Logging in...' : 'Sign In'}
              </Button>
            </form>
          </CardContent>

          <CardFooter className="flex-col gap-4 pt-0">
            <div className="relative w-full my-2">
              <div className="absolute inset-0 flex items-center">
                <span className="w-full border-t border-zinc-200 dark:border-zinc-800" />
              </div>
              <div className="relative flex justify-center text-xs uppercase">
                <span className="bg-white dark:bg-zinc-900/60 px-2 text-zinc-400 dark:text-zinc-500">
                  Or continue with
                </span>
              </div>
            </div>

            <Button
              variant="outline"
              className="w-full bg-white text-zinc-700 border-zinc-200 hover:bg-zinc-50 dark:bg-transparent dark:text-zinc-300 dark:border-zinc-800 dark:hover:bg-zinc-800 transition-colors"
              disabled={isAnyLoading || isGoogleLoading}
              onClick={() => googleOAuth()}
            >
              <svg className="mr-2 h-4 w-4" viewBox="0 0 24 24">
                <path
                  d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"
                  fill="#4285F4"
                />
                <path
                  d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"
                  fill="#34A853"
                />
                <path
                  d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"
                  fill="#FBBC05"
                />
                <path
                  d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"
                  fill="#EA4335"
                />
              </svg>
              Google
            </Button>

            <div className="text-sm text-center">
              <span className="text-zinc-500 dark:text-zinc-400">Don&apos;t have an account? </span>
              <Link href="/register" className="text-blue-600 hover:text-blue-500 font-medium dark:text-blue-400 hover:underline">
                Register
              </Link>
            </div>
          </CardFooter>
        </Card>
      </div>
    </div>
  );
}

```

### app\(auth)\register\page.tsx
```tsx
"use client"

import { Button } from "@/components/ui/button"
import {
  Card,
  CardContent,
  CardDescription,
  CardFooter,
  CardHeader,
  CardTitle,
} from "@/components/ui/card"
import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"
import { useForm } from "react-hook-form"
import { z } from "zod"
import { zodResolver } from "@hookform/resolvers/zod"
import Link from "next/link"
import { useRegisterMutation } from "@/hooks/useRegisterMutation"
import { Mail } from "lucide-react"

// Define a schema for form validation
const registerSchema = z.object({
  name: z.string().min(1, "Name is required"),
  email: z.string().email("Please enter a valid email"),
  password: z.string().min(6, "Password must be at least 6 characters"),
  birthday: z.string().optional(),
})

// Define the form data type based on the schema
type RegisterData = z.infer<typeof registerSchema>;

export default function Register() {
  const { register: registerUser, isLoading, error: registerError, success } = useRegisterMutation();

  const {
    register,
    handleSubmit,
    formState: { errors },
  } = useForm<RegisterData>({
    resolver: zodResolver(registerSchema),
  });

  const onSubmit = async (data: RegisterData) => {
    try {
      const registerData = {
        ...data,
        birthday: data.birthday ? new Date(data.birthday) : undefined,
      };
      await registerUser(registerData);
    } catch (error) {
      // Error handled by hook
    }
  };

  return (
    // WRAPPER CHÍNH: Giữ nguyên cấu trúc background như trang Login
    <div className="relative w-full min-h-screen flex flex-col items-center justify-center overflow-hidden bg-gray-50 dark:bg-zinc-950 transition-colors duration-300">
      
      {/* --- LỚP NỀN (BACKGROUND DECOR) --- */}
      <div className="absolute inset-0 z-0 h-full w-full">
        {/* Grid Pattern */}
        <div className="absolute h-full w-full bg-[linear-gradient(to_right,#00000008_1px,transparent_1px),linear-gradient(to_bottom,#00000008_1px,transparent_1px)] dark:bg-[linear-gradient(to_right,#8080800a_1px,transparent_1px),linear-gradient(to_bottom,#8080800a_1px,transparent_1px)] bg-[size:24px_24px]"></div>
        
        {/* Glow Effect */}
        <div className="absolute left-0 right-0 top-0 -z-10 m-auto h-[350px] w-[350px] rounded-full bg-blue-400/20 blur-[80px] dark:bg-blue-600/20 dark:blur-[100px]"></div>
      </div>

      {/* --- HEADER --- */}
      <header className="absolute top-0 z-50 w-full">
        <div className="container mx-auto px-4 sm:px-6 lg:px-8">
          <div className="flex h-16 items-center justify-between">
            <div className="flex items-center gap-2">
              <Mail className="h-6 w-6 text-blue-600 dark:text-blue-500 align-middle" />
              <Link href="/" className="text-xl font-bold text-zinc-900 dark:text-zinc-50 leading-none align-middle">
                Email Customize
              </Link>
            </div>
          </div>
        </div>
      </header>

      {/* --- CARD REGISTER --- */}
      <div className="z-10 w-full px-4 flex justify-center mt-10 mb-10">
        <Card className="w-full max-w-md bg-white shadow-[0_8px_30px_rgb(0,0,0,0.04)] border-zinc-100 dark:bg-zinc-900/60 dark:backdrop-blur-xl dark:border-zinc-800 dark:shadow-2xl">
          
          <CardHeader className="space-y-1">
            <CardTitle className="text-2xl font-bold text-center text-zinc-900 dark:text-zinc-50">Register</CardTitle>
            <CardDescription className="text-center text-zinc-500 dark:text-zinc-400">
              Hi, Enter your details to create an account
            </CardDescription>
          </CardHeader>

          <CardContent>
            <form onSubmit={handleSubmit(onSubmit)}>
              {/* Error Message */}
              {registerError && (
                <div className="mb-4 p-3 rounded-md bg-red-50 border border-red-100 dark:bg-red-900/20 dark:border-red-800 flex items-center gap-2">
                   <div className="h-2 w-2 rounded-full bg-red-500 shrink-0" />
                   <p className="text-red-600 dark:text-red-400 text-sm font-medium">{registerError}</p>
                </div>
              )}

              {/* Success Message */}
              {success && (
                <div className="mb-4 p-3 rounded-md bg-green-50 border border-green-100 dark:bg-green-900/20 dark:border-green-800 flex items-center gap-2">
                   <div className="h-2 w-2 rounded-full bg-green-500 shrink-0" />
                   <p className="text-green-600 dark:text-green-400 text-sm font-medium">
                     Registration successful! Redirecting...
                   </p>
                </div>
              )}

              <div className="flex flex-col gap-5">
                {/* Name Input */}
                <div className="grid gap-2">
                  <Label htmlFor="name" className="text-zinc-700 dark:text-zinc-300">Name</Label>
                  <Input
                    id="name"
                    type="text"
                    placeholder="John Doe"
                    {...register("name")}
                    disabled={isLoading || success}
                    className="bg-zinc-50 border-zinc-200 focus:bg-white transition-all dark:bg-zinc-950/50 dark:border-zinc-800"
                    required
                  />
                  {errors.name && <p className="text-red-500 text-sm">{errors.name.message}</p>}
                </div>

                {/* Email Input */}
                <div className="grid gap-2">
                  <Label htmlFor="email" className="text-zinc-700 dark:text-zinc-300">Email</Label>
                  <Input
                    id="email"
                    type="email"
                    placeholder="name@example.com"
                    {...register("email")}
                    disabled={isLoading || success}
                    className="bg-zinc-50 border-zinc-200 focus:bg-white transition-all dark:bg-zinc-950/50 dark:border-zinc-800"
                    required
                  />
                  {errors.email && <p className="text-red-500 text-sm">{errors.email.message}</p>}
                </div>

                {/* Password Input */}
                <div className="grid gap-2">
                  <Label htmlFor="password" className="text-zinc-700 dark:text-zinc-300">Password</Label>
                  <Input
                    id="password"
                    type="password"
                    placeholder="••••••••"
                    {...register("password")}
                    disabled={isLoading || success}
                    className="bg-zinc-50 border-zinc-200 focus:bg-white transition-all dark:bg-zinc-950/50 dark:border-zinc-800"
                    required
                  />
                  {errors.password && <p className="text-red-500 text-sm">{errors.password.message}</p>}
                </div>

                {/* Birthday Input */}
                <div className="grid gap-2">
                  <Label htmlFor="birthday" className="text-zinc-700 dark:text-zinc-300">Birthday</Label>
                  <Input
                    id="birthday"
                    type="date"
                    {...register("birthday")}
                    disabled={isLoading || success}
                    className="bg-zinc-50 border-zinc-200 focus:bg-white transition-all dark:bg-zinc-950/50 dark:border-zinc-800 block w-full"
                  />
                </div>
              </div>

              <Button type="submit" className="w-full mt-6 bg-blue-600 hover:bg-blue-700 text-white font-medium shadow-sm dark:shadow-blue-900/20" disabled={isLoading || success}>
                {isLoading ? 'Creating account...' : 'Create Account'}
              </Button>
            </form>
          </CardContent>
          
          <CardFooter className="justify-center pt-0 pb-6">
            <div className="text-sm text-center">
              <span className="text-zinc-500 dark:text-zinc-400">Already have an account? </span>
              <Link href="/login" className="text-blue-600 hover:text-blue-500 font-medium dark:text-blue-400 hover:underline">
                Login
              </Link>
            </div>
          </CardFooter>
        </Card>
      </div>
    </div>
  );
}
```

### app\inbox\page.tsx
```tsx
"use client";

import { useState, useEffect } from "react";
import { useRouter } from "next/navigation";
import { useAuth } from "@/contexts/auth-context";
import { useUI } from "@/contexts/ui-context"; // Import useUI
import MailBox from "@/components/ui/MailBox";
import MailContent from "@/components/ui/MailContent";
import ForwardModal from "@/components/ui/ForwardModal";
import Kanban from "@/components/ui/Kanban";
import { type Mail, type EmailData } from "@/types";

export default function Home() {
  const router = useRouter();
  const { isAuthenticated, isLoading: isAuthLoading } = useAuth();

  // Lấy state từ Global UI Context thay vì state cục bộ
  const { isKanBanMode, toggleKanBanMode, toggleSidebar } = useUI();

  // State quản lý dữ liệu Mail
  const [mails, setMails] = useState<Mail[]>([]);
  const [selectedMail, setSelectedMail] = useState<EmailData | null>(null);
  const [isMailsLoading, setIsMailsLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  // Pagination state
  const [nextPageToken, setNextPageToken] = useState<string | null>(null);
  const [hasMore, setHasMore] = useState(true);
  const [isLoadingMore, setIsLoadingMore] = useState(false);

  // State for keyboard navigation
  const [focusedIndex, setFocusedIndex] = useState<number>(0);

  // State for forward modal
  const [isForwardOpen, setIsForwardOpen] = useState(false);

  // Counter to trigger reply mode
  const [replyTrigger, setReplyTrigger] = useState(0);

  // 1. Client-side authentication check
  useEffect(() => {
    if (!isAuthLoading && !isAuthenticated) {
      router.push("/login");
    }
  }, [isAuthenticated, isAuthLoading, router]);

  // 2. Call API lấy danh sách mail
  useEffect(() => {
    if (isAuthenticated) {
      const fetchMails = async () => {
        try {
          setIsMailsLoading(true);
          setError(null);
          const id = "INBOX";
          const limit = 20;

          const token =
            typeof window !== "undefined" ? window.__accessToken : null;
          if (!token) {
            setIsMailsLoading(false);
            return;
          }

          const maiURL =
            process.env.NEXT_PUBLIC_BACKEND_API_URL || "http://localhost:5000";
          const response = await fetch(
            `${maiURL}/mailboxes/${id}/emails?limit=${limit}`,
            {
              method: "GET",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${token}`,
              },
            }
          );

          if (!response.ok) throw new Error("Failed to fetch mails");

          const data = await response.json();
          const fetched = Array.isArray(data?.messages)
            ? data.messages
            : Array.isArray(data)
            ? data
            : [];

          setMails(fetched);
          setNextPageToken(data.nextPageToken || null);
          setHasMore(!!data.nextPageToken);
        } catch (err: any) {
          setError(err.message || "Something went wrong");
        } finally {
          setIsMailsLoading(false);
        }
      };

      fetchMails();
    }
  }, [isAuthenticated]);

  // Load more function ... (Giữ nguyên logic cũ của bạn)
  const loadMoreMails = async () => {
    if (!hasMore || isLoadingMore || !nextPageToken) return;
    // ... Logic giống code cũ
    // Lưu ý: Đảm bảo copy lại phần logic loadMoreMails từ code cũ vào đây
    try {
      setIsLoadingMore(true);
      const token = typeof window !== "undefined" ? window.__accessToken : null;
      if (!token) return;
      const maiURL =
        process.env.NEXT_PUBLIC_BACKEND_API_URL || "http://localhost:5000";
      const response = await fetch(
        `${maiURL}/mailboxes/INBOX/emails?limit=20&pageToken=${nextPageToken}`,
        {
          headers: { Authorization: `Bearer ${token}` },
        }
      );
      if (!response.ok) throw new Error("Failed");
      const data = await response.json();
      const newMails = Array.isArray(data?.messages) ? data.messages : [];
      setMails((prev) => {
        const existingIds = new Set(prev.map((m) => m.id));
        const uniqueNewMails = newMails.filter(
          (m: Mail) => !existingIds.has(m.id)
        );
        return [...prev, ...uniqueNewMails];
      });
      setNextPageToken(data.nextPageToken || null);
      setHasMore(!!data.nextPageToken);
    } catch (err) {
      console.error(err);
    } finally {
      setIsLoadingMore(false);
    }
  };

  // Scroll handler ... (Giữ nguyên)
  useEffect(() => {
    const handleScroll = (e: Event) => {
      const target = e.target as HTMLElement;
      if (!target.classList.contains("mailbox-scroll-container")) return;
      const { scrollTop, scrollHeight, clientHeight } = target;
      if (
        (scrollTop + clientHeight) / scrollHeight > 0.8 &&
        hasMore &&
        !isLoadingMore
      ) {
        loadMoreMails();
      }
    };
    const container = document.querySelector(".mailbox-scroll-container");
    if (container) {
      container.addEventListener("scroll", handleScroll);
      return () => container.removeEventListener("scroll", handleScroll);
    }
  }, [hasMore, isLoadingMore, nextPageToken]);

  // Handler select mail ... (Giữ nguyên logic)
  const handleSelectMail = async (mail: Mail) => {
    // ... Logic fetch detail mail giống cũ
    try {
      const token = typeof window !== "undefined" ? window.__accessToken : null;
      if (!token) return;
      const maiURL =
        process.env.NEXT_PUBLIC_BACKEND_API_URL || "http://localhost:5000";
      const response = await fetch(`${maiURL}/emails/${mail.id}`, {
        headers: { Authorization: `Bearer ${token}` },
      });
      if (!response.ok) throw new Error("Failed");
      const data = await response.json();
      setSelectedMail(data);
    } catch (err) {
      console.error(err);
    }
  };

  // Hàm send email riêng cho Forward Modal (vì modal này nằm trong Page)
  const handleForwardEmail = async (emailData: any) => {
    const token = typeof window !== "undefined" ? window.__accessToken : null;
    if (!token) throw new Error("Not authenticated");
    const apiURL =
      process.env.NEXT_PUBLIC_BACKEND_API_URL || "http://localhost:5000";
    const response = await fetch(`${apiURL}/emails/send`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        Authorization: `Bearer ${token}`,
      },
      body: JSON.stringify(emailData),
    });
    if (!response.ok) throw new Error("Failed to send");
    return await response.json();
  };

  if (isAuthLoading) return null; // Hoặc loading spinner
  if (!isAuthenticated) return null;

  // Render
  return (
    <div className="flex h-full w-full">
      {/* SideBar đã bị xóa khỏi đây vì nó nằm ở AppShell (Layout).
         ComposeModal cũng nằm ở AppShell.
      */}

      {/* Cột Danh sách Mail */}
      <div
        className={`
          h-full 
          ${selectedMail ? "hidden" : "flex"} 
          md:flex md:w-1/3 w-full
        `}
      >
        {isMailsLoading ? (
          <div className="flex items-center justify-center w-full h-full">
            <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
          </div>
        ) : error ? (
          <div className="text-red-500 flex items-center justify-center w-full">
            {error}
          </div>
        ) : (
          <MailBox
            toggleSidebar={toggleSidebar}
            mails={mails}
            selectedMail={selectedMail}
            onSelectMail={handleSelectMail}
            focusedIndex={focusedIndex}
            isLoadingMore={isLoadingMore}
            hasMore={hasMore}
            kanbanMode={isKanBanMode}
            kanbanClick={toggleKanBanMode}
          />
        )}
      </div>

      {/* Cột Nội dung Mail / Kanban */}
      <div
        className={`
          h-full 
          ${selectedMail ? "flex" : "hidden"} 
          md:flex md:w-2/3 w-full
        `}
      >
        {isKanBanMode ? (
          <Kanban />
        ) : (
          <MailContent
            mail={selectedMail}
            onBack={() => setSelectedMail(null)}
            onForwardClick={() => selectedMail && setIsForwardOpen(true)}
            onReplyClick={() => setReplyTrigger((prev) => prev + 1)}
            triggerReply={replyTrigger}
          />
        )}
      </div>

      {/* Forward Modal vẫn giữ ở Page vì nó phụ thuộc vào selectedMail */}
      {selectedMail && (
        <ForwardModal
          isOpen={isForwardOpen}
          onClose={() => setIsForwardOpen(false)}
          onSend={handleForwardEmail}
          originalMail={selectedMail}
        />
      )}
    </div>
  );
}

```

### app\kanban\layout.tsx
```tsx
"use client";

import { UIProvider } from "@/contexts/ui-context";
import AppShell from "@/components/layout/AppShell";

export default function MailLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <UIProvider>
      <AppShell>{children}</AppShell>
    </UIProvider>
  );
}

```

### app\kanban\page.tsx
```tsx
import { useAuth } from "@/contexts/auth-context";

export default function KanbanPage() {
  return (
    <div className="flex h-screen w-full overflow-hidden bg-background">
      <main className="flex flex-1 h-full w-full relative"></main>
    </div>
  );
}

```

### components\auth-initializer.tsx
```tsx
"use client";

// ========================================
// Auth Initializer Component
// ========================================
// Component này chịu trách nhiệm initialize auth state
// Chạy useUserQuery hook để fetch user khi app mount
// ========================================

import { useUserQuery } from '@/hooks/useUserQuery';
import { ReactNode } from 'react';

export const AuthInitializer: React.FC<{ children: ReactNode }> = ({ children }) => {
  const { isLoading } = useUserQuery();

  // Show loading state while initializing auth, or show children when ready
  return isLoading ? (
    <div className="flex min-h-screen items-center justify-center">
      <div className="text-center">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900 dark:border-gray-100 mx-auto"></div>
        <p className="mt-4 text-sm text-gray-600 dark:text-gray-400">Loading...</p>
      </div>
    </div>
  ) : (
    <>{children}</>
  );
};

```

### components\logout-button.tsx
```tsx
"use client";

import { Button } from "@/components/ui/button";
import { useLogoutMutation } from "@/hooks/useLogoutMutation";
import { LogOut } from "lucide-react";

interface LogoutButtonProps {
  variant?: "default" | "destructive" | "outline" | "secondary" | "ghost" | "link";
  size?: "default" | "sm" | "lg" | "icon";
  className?: string;
  showIcon?: boolean;
  showText?: boolean;
}

export default function LogoutButton({ 
  variant = "outline", 
  size = "default",
  className = "",
  showIcon = true,
  showText = true 
}: LogoutButtonProps) {
  const { logout, isLoading } = useLogoutMutation();

  return (
    <Button 
      variant={variant} 
      size={size}
      onClick={logout}
      disabled={isLoading}
      className={className}
    >
      {showIcon && <LogOut className="h-4 w-4" />}
      {showText && (isLoading ? 'Logging out...' : 'Logout')}
    </Button>
  );
}

```

### components\theme-provider.js
```js
"use client";

import { useEffect, useState } from 'react';
import { ThemeProvider as NextThemesProvider } from 'next-themes';

const ThemeProviders = ({ children, attribute, defaultTheme, enableSystem }) => {
    const [mounted, setMounted] = useState(false);

    useEffect(() => {
        setMounted(true);
    }, []);

    if (!mounted) {
        return null;
    }

    return (
        <NextThemesProvider attribute={attribute} defaultTheme={defaultTheme} enableSystem={enableSystem}>
            {children}
        </NextThemesProvider>
    );
}

export default ThemeProviders;
```

### components\theme-switcher.tsx
```tsx
"use client";

import { useTheme } from "next-themes";
import { Button } from "@/components/ui/button";

export default function ThemeSwitcher() {
  const { theme, setTheme } = useTheme();

  return (
    <Button
      variant="outline"
      size="icon"
      onClick={() => setTheme(theme === "light" ? "dark" : "light")}
    >
      <Sun className="h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0" />
      <Moon className="absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100" />
      <span className="sr-only">Toggle theme</span>
    </Button>
  );
}

function Sun({ className, ...props }: { className?: string; [key: string]: any }) {
  return (
    <svg
      className={className}
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      strokeWidth="2"
      strokeLinecap="round"
      strokeLinejoin="round"
      {...props}
    >
      <circle cx="12" cy="12" r="4" />
      <path d="M12 2v2" />
      <path d="M12 20v2" />
      <path d="m4.93 4.93 1.41 1.41" />
      <path d="m17.66 17.66 1.41 1.41" />
      <path d="M2 12h2" />
      <path d="M20 12h2" />
      <path d="m6.34 6.34-1.41 1.41" />
      <path d="m19.07 19.07-1.41 1.41" />
    </svg>
  );
}

function Moon({ className, ...props }: { className?: string; [key: string]: any }) {
  return (
    <svg
      className={className}
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      strokeWidth="2"
      strokeLinecap="round"
      strokeLinejoin="round"
      {...props}
    >
      <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z" />
    </svg>
  );
}
```

### components\layout\AppShell.tsx
```tsx
"use client";

import { useAuth } from "@/contexts/auth-context";
import { useUI } from "@/contexts/ui-context";
import SideBar from "@/components/layout/SideBar";
import ComposeModal from "@/components/ui/ComposeModal";
// import { usePathname } from "next/navigation"; // Không cần nữa

export default function AppShell({ children }: { children: React.ReactNode }) {
  const { user, isAuthenticated } = useAuth(); // Vẫn giữ check auth để đảm bảo an toàn
  const {
    isSidebarExpanded,
    toggleSidebar,
    isKanBanMode,
    toggleKanBanMode,
    isComposeOpen,
    setComposeOpen,
  } = useUI();

  // Logic gửi email...
  const handleSendEmail = async (emailData: any) => {
    /* ... */
  };

  // Nếu chưa đăng nhập, trả về children để AuthInitializer xử lý redirect (hoặc return null)
  if (!isAuthenticated) {
    return <>{children}</>;
  }

  // KHÔNG CẦN CHECK LOGIC LOGIN Ở ĐÂY NỮA
  // Vì Layout này chỉ bọc các trang nội bộ (Inbox, Kanban)

  return (
    <div className="flex h-screen w-full overflow-hidden bg-background">
      <SideBar
        user={user}
        isExpanded={isSidebarExpanded}
        toggleSidebar={toggleSidebar}
        onComposeClick={() => setComposeOpen(true)}
        isKanbanMode={isKanBanMode}
        kanbanClick={toggleKanBanMode}
      />

      <main className="flex-1 h-full w-full relative overflow-hidden">
        {children}
      </main>

      <ComposeModal
        isOpen={isComposeOpen}
        onClose={() => setComposeOpen(false)}
        onSend={handleSendEmail}
      />
    </div>
  );
}

```

### components\layout\SideBar.tsx
```tsx
import {
  FaPenToSquare,
  FaInbox,
  FaRegStar,
  FaBoxArchive,
  FaTrashCan,
  FaMessage,
} from "react-icons/fa6";
import { LuSquareKanban } from "react-icons/lu";

import { IoSend, IoSettingsOutline } from "react-icons/io5";
import { RiErrorWarningFill } from "react-icons/ri";
import ThemeSwitcher from "@/components/theme-switcher";
import LogoutButton from "@/components/logout-button";
import { User } from "@/types/auth.types";

import { type NavItem, Label } from "@/types";

export interface SideBarProps {
  user: User | null;
  navigation?: {
    core: NavItem[];
    management: NavItem[];
    labels: Label[];
  };
  isExpanded: boolean; // Prop mới
  isKanbanMode: boolean; // Prop mới
  toggleSidebar: () => void; // Prop mới (dùng cho mobile để đóng)
  onComposeClick?: () => void; // Handler for New email button
  kanbanClick: () => void; // Handler for Kanban button
}

const nav = {
  core: [
    { title: "Inbox", path: "/inbox", icon: FaInbox, isActive: true },
    {
      title: "Favorites",
      path: "/favorites",
      icon: FaRegStar,
      isActive: false,
    },
    { title: "Drafts", path: "/drafts", icon: FaPenToSquare, isActive: false },
    { title: "Send", path: "/send", icon: IoSend, isActive: false },
  ],
  management: [
    { title: "Archive", path: "/archive", icon: FaBoxArchive, isActive: false },
    { title: "Spam", path: "/spam", icon: RiErrorWarningFill, isActive: false },
    { title: "Trash", path: "/trash", icon: FaTrashCan, isActive: false },
    {
      title: "Settings",
      path: "/settings",
      icon: IoSettingsOutline,
      isActive: false,
    },
  ],
  labels: [
    { id: "1", name: "Work", color: "red" },
    { id: "2", name: "Personal", color: "blue" },
  ],
};

const SideBar = ({
  user,
  isExpanded,
  navigation = nav,
  isKanbanMode,
  toggleSidebar,
  onComposeClick,
  kanbanClick,
}: SideBarProps) => {
  // Class chung cho các item
  const itemClass = `cursor-pointer flex flex-row items-center ${
    isExpanded ? "justify-between px-2" : "justify-center"
  } h-10 hover:bg-muted/50 rounded-md transition-all duration-200`;

  // Get user display data
  const userName = user?.name || user?.email?.split("@")[0] || "User";
  const userEmail = user?.email || "user@example.com";
  const userInitial = userName.charAt(0).toUpperCase();

  return (
    <>
      {/* Sidebar Container */}
      <div
        className={`
            flex flex-col h-full bg-background text-foreground py-4 justify-between 
            transition-all duration-300 ease-in-out
            ${/* Desktop Width */ isExpanded ? "md:w-64" : "md:w-20"}
            ${/* Mobile Position */ "fixed md:relative z-50 h-full"}
            ${
              /* Mobile Visibility */ isExpanded
                ? "translate-x-0 w-64"
                : "-translate-x-full w-64 md:translate-x-0"
            }
        `}
      >
        <div className={`px-4 flex flex-col ${!isExpanded && "items-center"}`}>
          {/* User Container */}
          <div
            className={`flex flex-row  items-center gap-2 ${
              isExpanded ? "justify-between" : "justify-center"
            } w-full`}
          >
            <div className="flex flex-row items-center gap-2">
              <div className="w-8 h-8 rounded-sm bg-muted border border-primary flex items-center justify-center shrink-0">
                <p>{userInitial}</p>
              </div>
            </div>
            {isExpanded && (
              <div
                className={`flex flex-col  gap-px overflow-hidden align-middle h-fit  ${
                  isExpanded
                    ? "opacity-100 max-h-20"
                    : "opacity-0 max-h-0 md:hidden"
                }`}
              >
                <span className="whitespace-nowrap">{userName}</span>
                <span className="text-secondary text-base truncate">
                  {userEmail}
                </span>
              </div>
            )}
          </div>

          {/* User Info Text */}

          {/* Create Mail Button */}
          <button
            onClick={onComposeClick}
            className={`mt-6 flex flex-row items-center gap-2 h-10 bg-muted rounded-md cursor-pointer hover:bg-muted/80 transition-all
              ${
                isExpanded
                  ? "px-4 w-full justify-start"
                  : "justify-center w-10 px-0"
              }
            `}
          >
            <div className="flex items-center justify-center">
              <FaPenToSquare />
            </div>
            {isExpanded && <span className="whitespace-nowrap">New email</span>}
          </button>

          {/* Core Menu */}
          <div className="flex flex-col mt-6 gap-2">
            {isExpanded && (
              <span className="text-secondary font-semibold text-sm px-2">
                Core
              </span>
            )}
            <div className="flex flex-col gap-1">
              {/* Menu Item: Inbox */}
              {
                /* Sử dụng lại itemClass cho đồng nhất */

                nav.core.map((item) => {
                  const Icon = item.icon;
                  return (
                    <div
                      key={item.title}
                      className={`cursor-pointer flex flex-row items-center ${
                        isExpanded ? "justify-between px-2" : "justify-center"
                      }
                        ${item.isActive ? "bg-primary/20" : "hover:bg-muted/50"}
                       h-10 hover:bg-muted/50 rounded-md transition-all duration-200`}
                    >
                      <div className="flex items-center justify-center">
                        <Icon
                          className={isExpanded ? "mr-2" : ""}
                          size={isExpanded ? 14 : 20}
                        />
                        {isExpanded && <span>{item.title}</span>}
                      </div>
                      {/* {isExpanded && (
                        <span className="text-secondary text-sm">3</span>
                      )} */}
                    </div>
                  );
                })
              }
            </div>
          </div>

          {/* Management Menu */}
          <div className="flex flex-col mt-6 gap-2">
            {isExpanded && (
              <p className="text-secondary font-semibold text-sm px-2">
                Management
              </p>
            )}
            <div className="flex flex-col gap-1">
              <div className={itemClass}>
                <div className="flex items-center justify-center">
                  <FaBoxArchive
                    className={isExpanded ? "mr-2" : ""}
                    size={isExpanded ? 14 : 20}
                  />
                  {isExpanded && <span>Archive</span>}
                </div>
                {isExpanded && (
                  <span className="text-secondary text-sm">3</span>
                )}
              </div>

              {/* Other items... shorten for brevity but applying same logic */}
              <div className={itemClass}>
                <div className="flex items-center justify-center">
                  <FaTrashCan
                    className={isExpanded ? "mr-2" : ""}
                    size={isExpanded ? 14 : 20}
                  />
                  {isExpanded && <span>Bin</span>}
                </div>
                {isExpanded && (
                  <span className="text-secondary text-sm">2</span>
                )}
              </div>
            </div>
          </div>
        </div>

        {/* Footer */}
        <div
          className={`flex flex-col px-4 pb-4 ${!isExpanded && "items-center"}`}
        >
          <button
            className={`cursor-pointer flex flex-row items-center  rounded-sm px-2 ${
              isExpanded ? "justify-start gap-2" : "justify-center"
            } py-2`}
          >
            <IoSettingsOutline size={20} />
            {isExpanded && <span>Settings</span>}
          </button>
          <button
            className={`cursor-pointer flex flex-row items-center rounded-sm px-2 ${
              isExpanded ? "justify-start gap-2" : "justify-center"
            }
              ${isKanbanMode ? "bg-primary/40" : "hover:bg-muted/50"}
             py-2`}
            onClick={() => {
              kanbanClick();
            }}
          >
            <LuSquareKanban size={18} />
            {isExpanded && <span>KanBan</span>}
          </button>

          <div
            className={`mt-4 flex items-center ${
              isExpanded ? "flex-row justify-between gap-2" : "flex-col gap-3"
            }`}
          >
            <ThemeSwitcher />
            <LogoutButton
              showText={isExpanded}
              size={isExpanded ? "default" : "icon"}
            />
          </div>
        </div>
      </div>

      {/* Mobile Overlay: Click outside to close */}
      {isExpanded && (
        <div
          className="fixed inset-0 bg-black/50 z-40 md:hidden"
          onClick={toggleSidebar}
        ></div>
      )}
    </>
  );
};
export default SideBar;

```

### components\ui\button.tsx
```tsx
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none cursor-pointer disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90",
        destructive:
          "bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",
        outline:
          "border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",
        secondary:
          "bg-secondary text-secondary-foreground hover:bg-secondary/80",
        ghost:
          "hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-9 px-4 py-2 has-[>svg]:px-3",
        sm: "h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",
        lg: "h-10 rounded-md px-6 has-[>svg]:px-4",
        icon: "size-9",
        "icon-sm": "size-8",
        "icon-lg": "size-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

function Button({
  className,
  variant,
  size,
  asChild = false,
  ...props
}: React.ComponentProps<"button"> &
  VariantProps<typeof buttonVariants> & {
    asChild?: boolean
  }) {
  const Comp = asChild ? Slot : "button"

  return (
    <Comp
      data-slot="button"
      className={cn(buttonVariants({ variant, size, className }))}
      {...props}
    />
  )
}

export { Button, buttonVariants }

```

### components\ui\card.tsx
```tsx
import * as React from "react"

import { cn } from "@/lib/utils"

function Card({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card"
      className={cn(
        "bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",
        className
      )}
      {...props}
    />
  )
}

function CardHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-header"
      className={cn(
        "@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",
        className
      )}
      {...props}
    />
  )
}

function CardTitle({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-title"
      className={cn("leading-none font-semibold", className)}
      {...props}
    />
  )
}

function CardDescription({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  )
}

function CardAction({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-action"
      className={cn(
        "col-start-2 row-span-2 row-start-1 self-start justify-self-end",
        className
      )}
      {...props}
    />
  )
}

function CardContent({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-content"
      className={cn("px-6", className)}
      {...props}
    />
  )
}

function CardFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-footer"
      className={cn("flex items-center px-6 [.border-t]:pt-6", className)}
      {...props}
    />
  )
}

export {
  Card,
  CardHeader,
  CardFooter,
  CardTitle,
  CardAction,
  CardDescription,
  CardContent,
}

```

### components\ui\ComposeModal.tsx
```tsx
'use client';

import { useState } from 'react';
import { Button } from './button';
import { Input } from './input';
import { Label } from './label';

interface ComposeModalProps {
  isOpen: boolean;
  onClose: () => void;
  onSend: (emailData: {
    to: string[];
    cc?: string[];
    bcc?: string[];
    subject: string;
    body: string;
    isHtml: boolean;
  }) => Promise<void>;
}

const ComposeModal = ({ isOpen, onClose, onSend }: ComposeModalProps) => {
  const [to, setTo] = useState('');
  const [cc, setCc] = useState('');
  const [bcc, setBcc] = useState('');
  const [subject, setSubject] = useState('');
  const [body, setBody] = useState('');
  const [showCc, setShowCc] = useState(false);
  const [showBcc, setShowBcc] = useState(false);
  const [isSending, setIsSending] = useState(false);

  const handleSend = async () => {
    if (!to.trim() || !subject.trim()) {
      alert('Please fill in recipient and subject');
      return;
    }

    setIsSending(true);
    try {
      await onSend({
        to: to.split(',').map(email => email.trim()).filter(Boolean),
        cc: cc ? cc.split(',').map(email => email.trim()).filter(Boolean) : undefined,
        bcc: bcc ? bcc.split(',').map(email => email.trim()).filter(Boolean) : undefined,
        subject,
        body,
        isHtml: false,
      });

      // Reset form
      setTo('');
      setCc('');
      setBcc('');
      setSubject('');
      setBody('');
      setShowCc(false);
      setShowBcc(false);
      onClose();
    } catch (error) {
      console.error('Failed to send email:', error);
      alert('Failed to send email. Please try again.');
    } finally {
      setIsSending(false);
    }
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50">
      <div className="bg-background border border-border rounded-lg shadow-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto m-4">
        {/* Header */}
        <div className="flex items-center justify-between p-4 border-b border-border">
          <h2 className="text-lg font-semibold">New Message</h2>
          <button
            onClick={onClose}
            className="text-muted-foreground hover:text-foreground"
          >
            ✕
          </button>
        </div>

        {/* Form */}
        <div className="p-4 space-y-3">
          {/* To Field */}
          <div className="flex items-center gap-2">
            <Label htmlFor="to" className="w-16 text-right">
              To:
            </Label>
            <Input
              id="to"
              value={to}
              onChange={(e) => setTo(e.target.value)}
              placeholder="recipient@example.com"
              className="flex-1"
            />
            {!showCc && (
              <button
                onClick={() => setShowCc(true)}
                className="text-sm text-muted-foreground hover:text-foreground"
              >
                Cc
              </button>
            )}
            {!showBcc && (
              <button
                onClick={() => setShowBcc(true)}
                className="text-sm text-muted-foreground hover:text-foreground"
              >
                Bcc
              </button>
            )}
          </div>

          {/* Cc Field */}
          {showCc && (
            <div className="flex items-center gap-2">
              <Label htmlFor="cc" className="w-16 text-right">
                Cc:
              </Label>
              <Input
                id="cc"
                value={cc}
                onChange={(e) => setCc(e.target.value)}
                placeholder="cc@example.com"
                className="flex-1"
              />
            </div>
          )}

          {/* Bcc Field */}
          {showBcc && (
            <div className="flex items-center gap-2">
              <Label htmlFor="bcc" className="w-16 text-right">
                Bcc:
              </Label>
              <Input
                id="bcc"
                value={bcc}
                onChange={(e) => setBcc(e.target.value)}
                placeholder="bcc@example.com"
                className="flex-1"
              />
            </div>
          )}

          {/* Subject Field */}
          <div className="flex items-center gap-2">
            <Label htmlFor="subject" className="w-16 text-right">
              Subject:
            </Label>
            <Input
              id="subject"
              value={subject}
              onChange={(e) => setSubject(e.target.value)}
              placeholder="Email subject"
              className="flex-1"
            />
          </div>

          {/* Body Field */}
          <div className="flex gap-2">
            <Label htmlFor="body" className="w-16 text-right pt-2">
              Message:
            </Label>
            <textarea
              id="body"
              value={body}
              onChange={(e) => setBody(e.target.value)}
              placeholder="Write your message here..."
              rows={10}
              className="flex-1 min-h-[200px] px-3 py-2 text-sm rounded-md border border-input bg-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"
            />
          </div>
        </div>

        {/* Footer */}
        <div className="flex items-center justify-end gap-2 p-4 border-t border-border">
          <Button variant="outline" onClick={onClose} disabled={isSending}>
            Cancel
          </Button>
          <Button onClick={handleSend} disabled={isSending}>
            {isSending ? 'Sending...' : 'Send'}
          </Button>
        </div>
      </div>
    </div>
  );
};

export default ComposeModal;

```

### components\ui\ForwardModal.tsx
```tsx
"use client";

import { useState } from "react";
import { Button } from "./button";
import { Input } from "./input";
import { Label } from "./label";
import { Mail } from "@/types";
import { type EmailData } from "@/types";

interface ForwardModalProps {
  isOpen: boolean;
  onClose: () => void;
  onSend: (emailData: {
    to: string[];
    cc?: string[];
    bcc?: string[];
    subject: string;
    body: string;
    isHtml: boolean;
  }) => Promise<void>;
  originalMail: EmailData;
}

const ForwardModal = ({
  isOpen,
  onClose,
  onSend,
  originalMail,
}: ForwardModalProps) => {
  const [to, setTo] = useState("");
  const [cc, setCc] = useState("");
  const [bcc, setBcc] = useState("");
  const [subject, setSubject] = useState(
    `Fwd: ${originalMail.subject || "No subject"}`
  );
  const [body, setBody] = useState(
    `\n\n---------- Forwarded message ---------\nFrom: ${
      originalMail.from
    }\nDate: ${originalMail.date}\nSubject: ${originalMail.subject}\nTo: ${
      originalMail.to || ""
    }\n\n${originalMail.snippet || ""}`
  );
  const [showCc, setShowCc] = useState(false);
  const [showBcc, setShowBcc] = useState(false);
  const [isSending, setIsSending] = useState(false);

  const handleSend = async () => {
    if (!to.trim()) {
      alert("Please fill in recipient");
      return;
    }

    setIsSending(true);
    try {
      await onSend({
        to: to
          .split(",")
          .map((email) => email.trim())
          .filter(Boolean),
        cc: cc
          ? cc
              .split(",")
              .map((email) => email.trim())
              .filter(Boolean)
          : undefined,
        bcc: bcc
          ? bcc
              .split(",")
              .map((email) => email.trim())
              .filter(Boolean)
          : undefined,
        subject,
        body,
        isHtml: false,
      });

      // Reset form
      setTo("");
      setCc("");
      setBcc("");
      setShowCc(false);
      setShowBcc(false);
      onClose();
    } catch (error) {
      console.error("Failed to forward email:", error);
      alert("Failed to forward email. Please try again.");
    } finally {
      setIsSending(false);
    }
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50">
      <div className="bg-background border border-border rounded-lg shadow-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto m-4">
        {/* Header */}
        <div className="flex items-center justify-between p-4 border-b border-border">
          <h2 className="text-lg font-semibold">Forward Message</h2>
          <button
            onClick={onClose}
            className="text-muted-foreground hover:text-foreground"
          >
            ✕
          </button>
        </div>

        {/* Form */}
        <div className="p-4 space-y-3">
          {/* To Field */}
          <div className="flex items-center gap-2">
            <Label htmlFor="to" className="w-16 text-right">
              To:
            </Label>
            <Input
              id="to"
              value={to}
              onChange={(e) => setTo(e.target.value)}
              placeholder="recipient@example.com"
              className="flex-1"
            />
            {!showCc && (
              <button
                onClick={() => setShowCc(true)}
                className="text-sm text-muted-foreground hover:text-foreground"
              >
                Cc
              </button>
            )}
            {!showBcc && (
              <button
                onClick={() => setShowBcc(true)}
                className="text-sm text-muted-foreground hover:text-foreground"
              >
                Bcc
              </button>
            )}
          </div>

          {/* Cc Field */}
          {showCc && (
            <div className="flex items-center gap-2">
              <Label htmlFor="cc" className="w-16 text-right">
                Cc:
              </Label>
              <Input
                id="cc"
                value={cc}
                onChange={(e) => setCc(e.target.value)}
                placeholder="cc@example.com"
                className="flex-1"
              />
            </div>
          )}

          {/* Bcc Field */}
          {showBcc && (
            <div className="flex items-center gap-2">
              <Label htmlFor="bcc" className="w-16 text-right">
                Bcc:
              </Label>
              <Input
                id="bcc"
                value={bcc}
                onChange={(e) => setBcc(e.target.value)}
                placeholder="bcc@example.com"
                className="flex-1"
              />
            </div>
          )}

          {/* Subject Field */}
          <div className="flex items-center gap-2">
            <Label htmlFor="subject" className="w-16 text-right">
              Subject:
            </Label>
            <Input
              id="subject"
              value={subject}
              onChange={(e) => setSubject(e.target.value)}
              placeholder="Email subject"
              className="flex-1"
            />
          </div>

          {/* Body Field */}
          <div className="flex gap-2">
            <Label htmlFor="body" className="w-16 text-right pt-2">
              Message:
            </Label>
            <textarea
              id="body"
              value={body}
              onChange={(e) => setBody(e.target.value)}
              placeholder="Write your message here..."
              rows={12}
              className="flex-1 min-h-[250px] px-3 py-2 text-sm rounded-md border border-input bg-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"
            />
          </div>
        </div>

        {/* Footer */}
        <div className="flex items-center justify-end gap-2 p-4 border-t border-border">
          <Button variant="outline" onClick={onClose} disabled={isSending}>
            Cancel
          </Button>
          <Button onClick={handleSend} disabled={isSending}>
            {isSending ? "Sending..." : "Send"}
          </Button>
        </div>
      </div>
    </div>
  );
};

export default ForwardModal;

```

### components\ui\input.tsx
```tsx
import * as React from "react"

import { cn } from "@/lib/utils"

function Input({ className, type, ...props }: React.ComponentProps<"input">) {
  return (
    <input
      type={type}
      data-slot="input"
      className={cn(
        "file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
        "focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]",
        "aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
        type === "date" && "text-muted-foreground",
        className
      )}
      {...props}
    />
  )
}

export { Input }

```

### components\ui\Kanban.tsx
```tsx
const Kanban = () => {
  return (
    <div className="w-full flex flex-col md:flex-row ">
      {/* Kanban InProgress*/}
      <div className="bg-secondary/10 rounded-lg p-4 m-2 flex-1">
        <h2 className="text-lg font-semibold mb-4 text-foreground">
          In Progress
        </h2>
        {/* Cards for In Progress mails would go here */}
      </div>
      {/* Kanban Done*/}
      <div className="bg-secondary/10 rounded-lg p-4 m-2 flex-1">
        <h2 className="text-lg font-semibold mb-4 text-foreground">Done</h2>
        {/* Cards for Done mails would go here */}
      </div>
    </div>
  );
};

export default Kanban;

```

### components\ui\label.tsx
```tsx
"use client"

import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"

import { cn } from "@/lib/utils"

function Label({
  className,
  ...props
}: React.ComponentProps<typeof LabelPrimitive.Root>) {
  return (
    <LabelPrimitive.Root
      data-slot="label"
      className={cn(
        "flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",
        className
      )}
      {...props}
    />
  )
}

export { Label }

```

### components\ui\MailBox.tsx
```tsx
import { TbLayoutSidebarRightExpandFilled } from "react-icons/tb";
// ... import khác giữ nguyên ...
import { BsFillLightningChargeFill } from "react-icons/bs";
import { FaSearch, FaUserAlt, FaBell, FaTag } from "react-icons/fa";
import { LuSquareKanban } from "react-icons/lu";

import { IoWarning } from "react-icons/io5";
import { Mail } from "@/types";
import { EmailData } from "@/types";
import { useEffect, useRef } from "react";

interface MailBoxProps {
  toggleSidebar: () => void;
  selectedMail?: EmailData | null;
  mails: Mail[];
  onSelectMail: (mail: Mail) => void;
  focusedIndex?: number;
  isLoadingMore?: boolean;
  hasMore?: boolean;
  kanbanMode: boolean;
  kanbanClick: () => void;
}

const MailBox = ({
  toggleSidebar,
  selectedMail,
  mails,
  onSelectMail,
  focusedIndex = 0,
  isLoadingMore = false,
  hasMore = true,
  kanbanMode = false,
  kanbanClick,
}: MailBoxProps) => {
  // Ref to track focused mail item for scroll-into-view
  const focusedItemRef = useRef<HTMLDivElement | null>(null);

  // Scroll focused item into view when focusedIndex changes
  useEffect(() => {
    if (focusedItemRef.current) {
      focusedItemRef.current.scrollIntoView({
        behavior: "smooth",
        block: "nearest",
      });
    }
  }, [focusedIndex]);

  // UPDATE 1: Đổi w-1/3 thành w-full.
  // Parent (Home) sẽ bọc component này trong một thẻ div có width responsive.
  return (
    <div className="mailbox-scroll-container flex flex-col w- bg-background border-x border-amber-50/50 h-full overflow-y-auto scrollbar-hide">
      {/* ... (Phần Header, Search, Filter Buttons giữ nguyên) ... */}
      <div className="flex flex-col justify-between p-5 sticky top-0 bg-background z-10">
        <div className="flex flex-row justify-between items-center">
          <div className="flex flex-row items-center gap-2">
            <button
              onClick={toggleSidebar}
              className="flex justify-center items-center h-8 w-8 hover:bg-secondary/10 rounded-md transition-colors cursor-pointer"
            >
              <TbLayoutSidebarRightExpandFilled size={20} className="" />
            </button>
            <h1 className="text-base font-semibold">Inbox</h1>
          </div>
          {/* kanban active/ unactive*/}
          <button
            onClick={kanbanClick}
            className={`flex justify-center items-center h-8 w-8  rounded-md transition-colors cursor-pointer ${
              kanbanMode ? "bg-primary/40 " : "hover:bg-secondary/60"
            }`}
          >
            <LuSquareKanban size={20} />
          </button>
        </div>
        {/* Search */}
        <div className="flex flex-row items-center mt-4 justify-center gap-3 p-2 rounded-md bg-background/70 border border-secondary focus-within:ring-1 ring-primary transition-all">
          <FaSearch className="text-gray-400" />
          <input
            type="text"
            placeholder="Search"
            className="w-full focus:outline-none placeholder-secondary bg-transparent"
          />
        </div>
      </div>
      <div className="w-full bg-secondary h-px opacity-30"></div>

      <main className="p-5 ">
        {/* Mail List */}
        <div className="">
          <div className="flex flex-col gap-2 ">
            {mails && mails.length > 0 ? (
              mails.map((mail, index) => {
                const isSelected = selectedMail?.id === mail.id;
                const isFocused = focusedIndex === index;

                return (
                  <div
                    key={mail.id}
                    ref={isFocused ? focusedItemRef : null}
                    onClick={() => onSelectMail(mail)}
                    draggable={true}
                    className={` 
                      flex flex-row justify-between items-start md:items-center p-3 rounded-md transition-all cursor-pointer border
                      ${
                        isSelected
                          ? "bg-primary/10 border-primary/50 shadow-sm"
                          : isFocused
                      }
                    `}
                  >
                    {/* ... (Nội dung từng item mail giữ nguyên) ... */}
                    <div className="flex items-start md:items-center w-full overflow-hidden">
                      {/* <img
                        src={
                          "https://avatar.iran.liara.run/username?username=" +
                          (mail.from || "someone")
                        }
                        alt="Avatar"
                        className="w-10 h-10 rounded-full mr-4 shrink-0 object-cover"
                      /> */}
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 24 24"
                        fill="#CCCCCC"
                        width="100px"
                        height="100px"
                        className="w-10 h-10 rounded-full mr-4 shrink-0 object-cover"
                      >
                        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                      </svg>
                      <div className="flex flex-col w-full min-w-0">
                        <div className="flex flex-row items-center justify-between">
                          <span
                            className={`mr-2 truncate text-secondary ${
                              isSelected
                                ? "font-bold text-foreground"
                                : "font-semibold"
                            }`}
                          >
                            {mail.from || "someone"}
                          </span>
                          <span className="text-secondary text-xs shrink-0">
                            {mail.date}
                          </span>
                        </div>
                        <div className="w-full">
                          <p className="text-sm truncate text-secondary">
                            {mail.subject || "No subject"}
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>
                );
              })
            ) : (
              <div className="text-center text-secondary text-sm mt-5">
                No mails found.
              </div>
            )}

            {/* Loading More Indicator */}
            {isLoadingMore && (
              <div className="flex justify-center items-center py-4">
                <div className="animate-spin rounded-full h-6 w-6 border-b-2 border-primary"></div>
                <span className="ml-2 text-sm text-secondary">
                  Loading more...
                </span>
              </div>
            )}

            {/* End of List Indicator */}
            {!hasMore && mails.length > 0 && (
              <div className="text-center text-secondary text-xs py-4">
                No more emails to load
              </div>
            )}
          </div>
        </div>
      </main>
    </div>
  );
};

export default MailBox;

```

### components\ui\MailContent.tsx
```tsx
import { useState, useEffect, useRef } from "react";
import { CiMail } from "react-icons/ci";
import {
  IoMdArrowBack,
  IoMdArrowForward,
  IoMdClose,
  IoMdMore,
  IoMdSend,
} from "react-icons/io";
import { BsArchive, BsTrash3 } from "react-icons/bs";
import { FaReply, FaShare } from "react-icons/fa";
import { type EmailData } from "@/types/index";

// --- CẤU HÌNH API ---
// Thay thế đường dẫn này bằng URL backend thực tế của bạn
const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || "http://localhost:5000";

interface MailContentProps {
  mail?: EmailData | null;
  onBack?: () => void;
  onForwardClick?: () => void;
  onReplyClick?: () => void;
  triggerReply?: number;
}

// ... (Giữ nguyên các hàm Helper: getSenderName, getSenderEmail, formatDate) ...
const getSenderName = (fromStr: string) => {
  if (!fromStr) return "Unknown";
  const parts = fromStr.split("<");
  return parts[0].trim().replace(/"/g, "") || fromStr;
};
const getSenderEmail = (fromStr: string) => {
  if (!fromStr) return "";
  const match = fromStr.match(/<([^>]+)>/);
  return match ? match[1] : fromStr;
};
const formatDate = (dateStr: string) => {
  try {
    const date = new Date(dateStr);
    return date.toLocaleString("en-US", {
      weekday: "short",
      year: "numeric",
      month: "short",
      day: "numeric",
      hour: "2-digit",
      minute: "2-digit",
    });
  } catch (e) {
    return dateStr;
  }
};

const MailContent = ({
  mail,
  onBack,
  onForwardClick,
  onReplyClick,
  triggerReply,
}: MailContentProps) => {
  const [isReplying, setIsReplying] = useState(false);
  const [replyBody, setReplyBody] = useState("");
  const [isSending, setIsSending] = useState(false);
  const replyTextareaRef = useRef<HTMLTextAreaElement>(null);

  // Trigger reply mode from parent (keyboard shortcut)
  useEffect(() => {
    if (triggerReply && triggerReply > 0) {
      setIsReplying(true);
    }
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [triggerReply]);

  // Focus and scroll to reply textarea when reply mode is activated
  useEffect(() => {
    if (isReplying && replyTextareaRef.current) {
      replyTextareaRef.current.focus();
      replyTextareaRef.current.scrollIntoView({
        behavior: "smooth",
        block: "center",
      });
    }
  }, [isReplying]);

  if (!mail) {
    return (
      <div className="flex flex-col w-full items-center justify-center h-full text-secondary bg-background/50">
        <CiMail className="w-16 h-16 mb-4 opacity-20" />
        <h2 className="text-xl font-semibold mb-2 text-secondary">
          No Mail Selected
        </h2>
      </div>
    );
  }

  const senderName = getSenderName(mail.from);
  const senderEmail = getSenderEmail(mail.from);

  const handleReplyClick = () => {
    setIsReplying(true);
    // Tùy chọn: Thêm chữ ký hoặc trích dẫn email cũ vào body
    // setReplyBody(`\n\nOn ${formatDate(mail.date)}, ${senderName} wrote:\n> ...`);
  };

  const handleCancelReply = () => {
    setIsReplying(false);
    setReplyBody("");
  };

  // --- HÀM GỌI API REPLY ---
  const handleSendReply = async () => {
    if (!replyBody.trim()) return;
    // Giả sử mail object có thuộc tính id. Nếu id nằm ở chỗ khác (vd: mail.messageId), hãy sửa lại.
    if (!mail.id) {
      alert("Error: Cannot identify email ID.");
      return;
    }

    setIsSending(true);

    try {
      // 1. Lấy Token từ in-memory storage
      const token = typeof window !== "undefined" ? window.__accessToken : null;

      if (!token) {
        alert("Bạn chưa đăng nhập hoặc phiên đăng nhập đã hết hạn.");
        setIsSending(false);
        return;
      }

      // 2. Gọi API
      const response = await fetch(`${API_BASE_URL}/emails/${mail.id}/reply`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${token}`, // Header Auth Required
        },
        body: JSON.stringify({
          body: replyBody,
          isHtml: false, // Vì dùng textarea thường nên set là false. Nếu dùng RichEditor, set true.
          attachments: [], // Chưa xử lý file đính kèm trong UI này
        }),
      });

      // 3. Xử lý kết quả
      if (!response.ok) {
        const errorData = await response.json().catch(() => ({}));
        throw new Error(errorData.message || "Failed to send reply");
      }

      // Thành công
      // const data = await response.json(); // Nếu cần dùng dữ liệu trả về

      setIsReplying(false);
      setReplyBody("");
      alert("Reply sent successfully!");
    } catch (error: any) {
      console.error("Error sending reply:", error);
      alert(`Error: ${error.message}`);
    } finally {
      setIsSending(false);
    }
  };

  return (
    <div className="flex flex-col w-full h-full bg-background text-gray-200 overflow-hidden relative">
      {/* --- TOP ACTION BAR --- */}
      <div className="flex flex-row justify-between items-center p-3 border-b border-white/10 shrink-0">
        <div className="flex items-center gap-4 text-gray-400">
          <button
            className="hover:text-white transition-color cursor-pointer"
            onClick={onBack}
          >
            <IoMdClose size={20} />
          </button>
          <div className="h-4 w-px bg-white/20 mx-1"></div>

          <button
            className="hover:text-white transition-colors md:hidden cursor-pointer"
            title="Back to Inbox"
            onClick={onBack}
          >
            <IoMdArrowBack size={20} />
          </button>

          <button className="hover:text-white transition-colors cursor-pointer">
            <IoMdArrowForward size={20} />
          </button>
        </div>

        <div className="flex items-center gap-2 text-gray-400">
          <button className="p-2 hover:bg-white/10 rounded-md transition-colors cursor-pointer">
            <BsArchive size={18} />
          </button>
          <button className="p-2 hover:bg-white/10 rounded-md transition-colors hover:text-red-400 cursor-pointer">
            <BsTrash3 size={18} />
          </button>
        </div>
      </div>

      {/* --- SCROLLABLE CONTENT AREA --- */}
      <div className="flex-1 overflow-y-auto p-6 custom-scrollbar pb-20">
        {/* Subject Header */}
        <div className="mb-6">
          <div className="flex flex-row justify-between items-start">
            <h1 className="text-xl md:text-2xl font-semibold text-white mb-3">
              {mail.subject || "(No Subject)"}
            </h1>
            <div className="flex gap-2">
              {mail.labelIds?.includes("SENT") && (
                <span className="bg-gray-700 text-xs px-2 py-1 rounded text-gray-300">
                  Sent Mail
                </span>
              )}
            </div>
          </div>
        </div>

        {/* Sender Info Row */}
        <div className="flex flex-row justify-between items-start mb-6">
          <div className="flex items-center gap-3">
            <div className="w-10 h-10 rounded-full bg-linear-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold border border-white/10 text-lg shrink-0">
              {senderName.charAt(0).toUpperCase()}
            </div>
            <div className="flex flex-col">
              <div className="flex items-center gap-2">
                <span className="font-bold text-white">{senderName}</span>
                <span className="text-xs text-gray-400">
                  &lt;{senderEmail}&gt;
                </span>
              </div>
              <span className="text-xs text-gray-500">To: {mail.to}</span>
            </div>
          </div>
          <div className="flex items-center gap-2 text-gray-500 text-sm">
            <span>{formatDate(mail.date)}</span>
            <button className="p-1 hover:bg-white/10 rounded hover:text-white cursor-pointer">
              <IoMdMore size={20} />
            </button>
          </div>
        </div>

        {/* Original Mail Body */}
        <div className="w-full bg-white text-secondary rounded-sm p-8 shadow-sm min-h-[200px] overflow-hidden border border-white/5">
          <div
            className="email-content-wrapper text-[15px] leading-relaxed"
            dangerouslySetInnerHTML={{
              __html:
                mail.htmlBody ||
                mail.textBody ||
                mail.snippet ||
                '<p class="text-secondary italic text-center mt-10">(No content available for this email)</p>',
            }}
          />
        </div>

        {/* --- REPLY EDITOR AREA --- */}
        {isReplying && (
          <div className="mt-6 flex flex-col gap-3 animate-in fade-in slide-in-from-bottom-4 duration-200">
            <div className="flex items-center gap-2 text-sm text-gray-400 mb-1">
              <FaReply /> Replying to{" "}
              <span className="text-white">{senderName}</span>
            </div>
            <textarea
              ref={replyTextareaRef}
              autoFocus
              className="w-full bg-[#1e1e1e] border border-white/20 rounded-md p-4 text-gray-200 focus:outline-none focus:border-blue-500 min-h-[150px] resize-y"
              placeholder="Type your reply here..."
              value={replyBody}
              onChange={(e) => setReplyBody(e.target.value)}
              disabled={isSending}
            />
            {/* Note: Nếu muốn thêm tính năng attach file, bạn cần thêm <input type="file"> ở đây và xử lý state attachments */}

            <div className="flex gap-3 mt-2">
              <button
                onClick={handleSendReply}
                disabled={isSending || !replyBody.trim()}
                className="flex items-center gap-2 px-6 py-2 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white text-sm rounded transition-colors cursor-pointer"
              >
                {isSending ? (
                  "Sending..."
                ) : (
                  <>
                    <IoMdSend /> Send
                  </>
                )}
              </button>
              <button
                onClick={handleCancelReply}
                disabled={isSending}
                className="px-4 py-2 hover:bg-white/10 text-gray-400 hover:text-white text-sm rounded transition-colors cursor-pointer"
              >
                Discard
              </button>
            </div>
          </div>
        )}

        <div className="h-10"></div>
      </div>

      {/* --- BOTTOM ACTION BAR --- */}
      {!isReplying && (
        <div className="absolute bottom-6 left-6 flex flex-row gap-3">
          <button
            onClick={handleReplyClick}
            className="flex items-center gap-2 px-4 py-2 bg-[#2c2c2c] hover:bg-[#383838] text-gray-200 text-sm rounded border border-white/10 transition-colors cursor-pointer shadow-lg"
          >
            <FaReply /> Reply
          </button>
          <button
            onClick={onForwardClick}
            className="flex items-center gap-2 px-4 py-2 bg-[#2c2c2c] hover:bg-[#383838] text-gray-200 text-sm rounded border border-white/10 transition-colors cursor-pointer shadow-lg"
          >
            <FaShare /> Forward
          </button>
        </div>
      )}
    </div>
  );
};

export default MailContent;

```

### components\ui\ThemeSwicher.tsx
```tsx
// components/Header.tsx
"use client";

import { useTheme } from "@/contexts/ThemeContext";

export function ThemeSwitcher() {
  const { theme, toggleTheme } = useTheme();

  return (
    <header className="bg-background border-b border-border p-4 sticky top-0 z-50">
      <div className="max-w-7xl mx-auto flex justify-between items-center">
        <h1 className="text-2xl font-bold text-foreground">My App</h1>

        <button
          onClick={toggleTheme}
          className="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/90 transition-colors flex items-center gap-2"
        >
          {theme === "light" ? (
            <>
              <MoonIcon className="w-4 h-4" />
              Dark Mode
            </>
          ) : (
            <>
              <SunIcon className="w-4 h-4" />
              Light Mode
            </>
          )}
        </button>
      </div>
    </header>
  );
}

// Simple icons components
function MoonIcon({ className }: { className?: string }) {
  return (
    <svg className={className} fill="currentColor" viewBox="0 0 20 20">
      <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" />
    </svg>
  );
}

function SunIcon({ className }: { className?: string }) {
  return (
    <svg className={className} fill="currentColor" viewBox="0 0 20 20">
      <path
        fillRule="evenodd"
        d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"
        clipRule="evenodd"
      />
    </svg>
  );
}

```

### contexts\auth-context.tsx
```tsx
"use client";

// ========================================
// AUTH CONTEXT - IN-MEMORY TOKEN STORAGE
// ========================================
// SECURITY STRATEGY:
// - Access Token: In-memory ONLY (not persisted)
// - Refresh Token: HttpOnly cookie ONLY (server-side)
// - User data: localStorage (for UX only, not sensitive)
// 
// Benefits:
// ✅ Access token immune to XSS (not in localStorage/cookies)
// ✅ Refresh token immune to XSS (HttpOnly cookie)
// ✅ CSRF protection via SameSite cookie attribute
// ========================================

import React, { createContext, useContext, useState, ReactNode, useEffect } from 'react';
import { User } from '@/types/auth.types';
import { getUserData, saveUserData, clearUserData } from '@/lib/token';

interface AuthContextType {
  user: User | null;
  isAuthenticated: boolean;
  isLoading: boolean;
  accessToken: string | null;  // 🔒 IN-MEMORY ONLY
  setUser: (user: User | null) => void;
  setIsAuthenticated: (value: boolean) => void;
  setIsLoading: (value: boolean) => void;
  setAccessToken: (token: string | null) => void;  // 🔒 IN-MEMORY ONLY
}

const AuthContext = createContext<AuthContextType | undefined>(undefined);

export const AuthProvider: React.FC<{ children: ReactNode }> = ({ children }) => {
  const [user, setUserState] = useState<User | null>(null);
  const [isAuthenticated, setIsAuthenticated] = useState(false);
  const [isLoading, setIsLoading] = useState(true);
  const [accessToken, setAccessToken] = useState<string | null>(null);  // 🔒 IN-MEMORY

  // Wrapper cho setUser để tự động lưu vào localStorage (chỉ user data, không có tokens)
  const setUser = (userData: User | null) => {
    setUserState(userData);
    if (userData) {
      saveUserData(userData);
    } else {
      clearUserData();
    }
  };

  // Restore user data từ localStorage khi component mount
  // NOTE: Không restore token - token phải được refresh từ HttpOnly cookie
  useEffect(() => {
    const savedUser = getUserData();
    if (savedUser) {
      setUserState(savedUser);
      console.log('[AuthContext] Restored user data from localStorage:', savedUser.email);
      // DON'T set isAuthenticated yet - wait for useUserQuery to validate session
    }
  }, []);

  return (
    <AuthContext.Provider
      value={{
        user,
        isAuthenticated,
        isLoading,
        accessToken,
        setUser,
        setIsAuthenticated,
        setIsLoading,
        setAccessToken,
      }}
    >
      {children}
    </AuthContext.Provider>
  );
};

// ========================================
// useAuth Hook
// ========================================
// Access auth state từ bất kỳ component nào

export const useAuth = () => {
  const context = useContext(AuthContext);
  if (context === undefined) {
    throw new Error('useAuth must be used within an AuthProvider');
  }
  return context;
};

```

### contexts\ThemeContext.tsx
```tsx
// contexts/ThemeContext.tsx
"use client";

import React, { createContext, useContext, useEffect, useState } from "react";

type Theme = "light" | "dark";

interface ThemeContextType {
  theme: Theme;
  toggleTheme: () => void;
}

const ThemeContext = createContext<ThemeContextType | undefined>(undefined);

export function ThemeProvider({ children }: { children: React.ReactNode }) {
  const [theme, setTheme] = useState<Theme>("light");

  useEffect(() => {
    // Kiểm tra theme từ localStorage hoặc system preference
    const saved = localStorage.getItem("theme") as Theme;
    if (saved) {
      setTheme(saved);
    } else if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
      setTheme("dark");
    }
  }, []);

  useEffect(() => {
    // Áp dụng theme lên document element
    const root = document.documentElement;
    root.setAttribute("data-theme", theme);
    localStorage.setItem("theme", theme);
  }, [theme]);

  const toggleTheme = () => {
    setTheme((prev) => (prev === "light" ? "dark" : "light"));
  };

  return (
    <ThemeContext.Provider value={{ theme, toggleTheme }}>
      {children}
    </ThemeContext.Provider>
  );
}

export function useTheme() {
  const context = useContext(ThemeContext);
  if (context === undefined) {
    throw new Error("useTheme must be used within a ThemeProvider");
  }
  return context;
}

```

### contexts\ui-context.tsx
```tsx
"use client";

import React, { createContext, useContext, useState } from "react";
import { useRouter } from "next/navigation";

interface UIContextType {
  isSidebarExpanded: boolean;
  toggleSidebar: () => void;
  isKanBanMode: boolean;
  toggleKanBanMode: () => void;
  isComposeOpen: boolean;
  setComposeOpen: (open: boolean) => void;
}

const UIContext = createContext<UIContextType | undefined>(undefined);

export function UIProvider({ children }: { children: React.ReactNode }) {
  const router = useRouter();
  const [isSidebarExpanded, setIsSidebarExpanded] = useState(true);

  // State quản lý Kanban mode
  const [isKanBanMode, setIsKanBanMode] = useState(false);
  const [isComposeOpen, setIsComposeOpen] = useState(false);

  const toggleSidebar = () => setIsSidebarExpanded((prev) => !prev);

  // --- SỬA LỖI TẠI ĐÂY ---
  const toggleKanBanMode = () => {
    // 1. Tính toán giá trị mới dựa trên giá trị hiện tại
    const nextMode = !isKanBanMode;

    // 2. Cập nhật State
    setIsKanBanMode(nextMode);

    // 3. Thực hiện điều hướng (Side Effect) Ở NGOÀI hàm setState
    if (nextMode) {
      router.push("/kanban");
    } else {
      router.push("/");
    }
  };

  return (
    <UIContext.Provider
      value={{
        isSidebarExpanded,
        toggleSidebar,
        isKanBanMode,
        toggleKanBanMode, // Truyền hàm đã sửa vào đây
        isComposeOpen,
        setComposeOpen: setIsComposeOpen,
      }}
    >
      {children}
    </UIContext.Provider>
  );
}

export function useUI() {
  const context = useContext(UIContext);
  if (context === undefined) {
    throw new Error("useUI must be used within a UIProvider");
  }
  return context;
}

```

### hooks\useGoogleLoginMutation.ts
```ts
// ========================================
// useGoogleLoginMutation Hook
// ========================================
// Handle Google OAuth login logic
// ========================================

import { useState } from 'react';
import { useRouter } from 'next/navigation';
import { useAuth } from '@/contexts/auth-context';
import { loginWithGoogle as loginWithGoogleApi } from '@/lib/auth';
import { setGlobalAccessToken } from '@/lib/api';

export const useGoogleLoginMutation = () => {
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const { setUser, setIsAuthenticated, setAccessToken } = useAuth();
  const router = useRouter();

  const loginWithGoogle = async (credentialToken: string) => {
    try {
      setIsLoading(true);
      setError(null);

      // Call API with Google credential (refreshToken set as HttpOnly cookie by backend)
      const response = await loginWithGoogleApi(credentialToken);

      // Update global state with IN-MEMORY access token
      setUser(response.user);
      setIsAuthenticated(true);
      setAccessToken(response.accessToken);  // 🔒 Store in AuthContext
      setGlobalAccessToken(response.accessToken);  // 🔒 Store in window (for axios interceptor)

      console.log('[useGoogleLoginMutation] ✅ Google login successful, access token stored in-memory');

      // Small delay to ensure state is propagated before redirect
      await new Promise(resolve => setTimeout(resolve, 100));

      // Redirect to inbox
      router.push('/inbox');

      return response;
    } catch (err: any) {
      const message = err.response?.data?.message || err.message || 'Google login failed';
      setError(message);
      throw new Error(message);
    } finally {
      setIsLoading(false);
    }
  };

  return {
    loginWithGoogle,
    isLoading,
    error,
  };
};

```

### hooks\useLoginMutation.ts
```ts
// ========================================
// useLoginMutation Hook
// ========================================
// Handle login logic
// ========================================

import { useState } from 'react';
import { useRouter } from 'next/navigation';
import { useAuth } from '@/contexts/auth-context';
import { login as loginApi } from '@/lib/auth';
import { setGlobalAccessToken } from '@/lib/api';
import { LoginCredentials } from '@/types/auth.types';

export const useLoginMutation = () => {
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const { setUser, setIsAuthenticated, setAccessToken } = useAuth();
  const router = useRouter();

  const login = async (credentials: LoginCredentials) => {
    try {
      setIsLoading(true);
      setError(null);

      // Call API (refreshToken automatically set as HttpOnly cookie by backend)
      const response = await loginApi(credentials);

      // Update global state with IN-MEMORY access token
      setUser(response.user);
      setIsAuthenticated(true);
      setAccessToken(response.accessToken);  // 🔒 Store in AuthContext
      setGlobalAccessToken(response.accessToken);  // 🔒 Store in window (for axios interceptor)

      console.log('[useLoginMutation] ✅ Login successful, access token stored in-memory');

      // Small delay to ensure state is propagated before redirect
      await new Promise(resolve => setTimeout(resolve, 100));

      // Redirect
      router.push('/inbox');

      return response;
    } catch (err: any) {
      const message = err.response?.data?.message || err.message || 'Login failed';
      setError(message);
      throw new Error(message);
    } finally {
      setIsLoading(false);
    }
  };

  return {
    login,
    isLoading,
    error,
  };
};

```

### hooks\useLogoutMutation.ts
```ts
// ========================================
// useLogoutMutation Hook
// ========================================
// Handle logout logic
// ========================================

import { useState } from 'react';
import { useRouter } from 'next/navigation';
import { useAuth } from '@/contexts/auth-context';
import { logout as logoutApi } from '@/lib/auth';

export const useLogoutMutation = () => {
  const [isLoading, setIsLoading] = useState(false);
  const { setUser, setIsAuthenticated, setAccessToken } = useAuth();
  const router = useRouter();

  const logout = async () => {
    try {
      setIsLoading(true);

      // Call API to logout (clears HttpOnly cookie)
      await logoutApi();
    } catch (error) {
      console.error('Logout error:', error);
      // Continue with logout even if API fails
    } finally {
      // Clear global state (in-memory access token)
      setUser(null);
      setIsAuthenticated(false);
      setAccessToken(null);  // 🔒 Clear AuthContext
      setIsLoading(false);
      
      // Clear window.__accessToken
      if (typeof window !== 'undefined') {
        window.__accessToken = null;
      }

      console.log('[useLogoutMutation] ✅ Logged out, access token cleared from memory');

      // Redirect to login
      router.push('/login');
    }
  };

  return {
    logout,
    isLoading,
  };
};

```

### hooks\useRegisterMutation.ts
```ts
// ========================================
// useRegisterMutation Hook
// ========================================
// Handle user registration
// ========================================

import { useState } from 'react';
import { useRouter } from 'next/navigation';
import { register as registerApi } from '@/lib/auth';
import { RegisterCredentials } from '@/types/auth.types';

export const useRegisterMutation = () => {
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [success, setSuccess] = useState(false);
  const router = useRouter();

  const register = async (credentials: RegisterCredentials) => {
    try {
      setIsLoading(true);
      setError(null);
      setSuccess(false);

      // Call API
      const user = await registerApi(credentials);

      setSuccess(true);

      // Redirect to login after 2 seconds
      setTimeout(() => {
        router.push('/login');
      }, 2000);

      return user;
    } catch (err: any) {
      const message = err.response?.data?.message || err.message || 'Registration failed';
      setError(message);
      throw new Error(message);
    } finally {
      setIsLoading(false);
    }
  };

  return {
    register,
    isLoading,
    error,
    success,
  };
};

```

### hooks\useUserQuery.ts
```ts
// ========================================
// useUserQuery Hook
// ========================================
// Fetch and initialize user session
// ========================================

import { useEffect } from 'react';
import { useAuth } from '@/contexts/auth-context';
import { getCurrentUser } from '@/lib/auth';
import { setGlobalAccessToken } from '@/lib/api';
import { clearTokens } from '@/lib/token';

/**
 * Hook để initialize và maintain user session
 * Tự động chạy khi app mount
 * 
 * NEW SECURE STRATEGY:
 * - Access token: In-memory only (AuthContext + window.__accessToken)
 * - Refresh token: HttpOnly cookie only (sent automatically)
 * 
 * Logic:
 * 1. Kiểm tra có accessToken trong AuthContext không
 * 2. Nếu có: Fetch user profile
 * 3. Nếu không có: Gọi /auth/refresh (refreshToken tự động gửi qua cookie)
 * 4. Nếu refresh thành công: Lưu accessToken và fetch user profile
 * 5. Nếu refresh thất bại: Set unauthenticated
 */
export const useUserQuery = () => {
  const { setUser, setIsAuthenticated, setIsLoading, setAccessToken, accessToken, isLoading } = useAuth();

  useEffect(() => {
    const initializeAuth = async () => {
      console.log('[useUserQuery] 🔄 Initialization - Has in-memory accessToken:', !!accessToken);
      
      if (accessToken) {
        // Có accessToken in-memory → fetch user profile
        console.log('[useUserQuery] Has accessToken in-memory, fetching user profile...');
        try {
          const userProfile = await getCurrentUser();
          
          setUser(userProfile);
          setIsAuthenticated(true);
          console.log('[useUserQuery] ✅ User authenticated:', userProfile.email);
          setIsLoading(false);
          return;
        } catch (fetchError: any) {
          console.error('[useUserQuery] ❌ Failed to fetch user:', fetchError?.response?.status, fetchError?.message);
          // Access token might be expired, will try refresh below
        }
      }
      
      // Only try refresh if we don't have a token AND we're still loading
      if (!accessToken && isLoading) {
        // Không có accessToken → thử refresh từ HttpOnly cookie
        console.log('[useUserQuery] No accessToken, attempting to refresh from HttpOnly cookie...');
        
        try {
          const backendUrl = process.env.NEXT_PUBLIC_BACKEND_API_URL || 'http://localhost:5000';
          const refreshResponse = await fetch(`${backendUrl}/auth/refresh`, {
            method: 'POST',
            credentials: 'include',  // 🔒 Send HttpOnly cookie automatically
            headers: { 'Content-Type': 'application/json' }
          });
          
          console.log('[useUserQuery] Refresh response:', refreshResponse.status);
          
          if (refreshResponse.ok) {
            const { accessToken: newAccessToken } = await refreshResponse.json();
            
            // Store new access token in-memory
            setAccessToken(newAccessToken);  // AuthContext
            setGlobalAccessToken(newAccessToken);  // window.__accessToken for axios
          
            console.log('[useUserQuery] ✅ Token refreshed from HttpOnly cookie');
            
            // Fetch user profile with new token
            const userProfile = await getCurrentUser();
            setUser(userProfile);
            setIsAuthenticated(true);
            console.log('[useUserQuery] ✅ User authenticated:', userProfile.email);
          } else {
            console.log('[useUserQuery] ❌ No valid refresh token in HttpOnly cookie');
            clearTokens();
            setUser(null);
            setIsAuthenticated(false);
          }
        } catch (error) {
          console.error('[useUserQuery] ❌ Refresh error:', error);
          clearTokens();
          setUser(null);
          setIsAuthenticated(false);
        } finally {
          setIsLoading(false);
        }
      }
    };

    initializeAuth();
    // Re-run when accessToken changes (e.g., after login)
  }, [accessToken]);

  return { isLoading };
};

```

### mockDatas\index.ts
```ts
export const mockMails = [
  {
    id: "19abe6bbc791af3c",
    threadId: "19abe6bbc791af3c",
    labelIds: ["UNREAD", "CATEGORY_UPDATES", "INBOX"],
    snippet:
      "Last chance: your subscription will be deactivated soon Atlassian This doesn&#39;t have to be goodbye Hi, It&#39;s not too late to keep the work you&#39;ve done so far! This is your last chance to add",
    subject: "Last chance: your subscription will be deactivated soon",
    from: "Atlassian <no_reply@am.atlassian.com>",
    to: "anhkhoa06052004@gmail.com",
    date: "Wed, 26 Nov 2025 04:28:42 +0000",
    sizeEstimate: 17111,
    internalDate: "1764131322000",
    isUnread: true,
    isStarred: false,
    hasAttachment: false,
  },
  {
    id: "19abe414e92b17e6",
    threadId: "19abe414e92b17e6",
    labelIds: ["UNREAD", "CATEGORY_UPDATES", "INBOX"],
    snippet:
      "Atlassian Your Jira subscription has moved to the Free plan Hi Trần, As requested, your Premium Jira subscription has moved to the Free plan. Here are the subscription details: Jira E-43Z-HM3-QKJ-FQA",
    subject: "You’re now on Jira Free plan",
    from: "Atlassian <noreply@po.atlassian.net>",
    to: '"Trần Anh Khoa" <anhkhoa06052004@gmail.com>',
    date: "Wed, 26 Nov 2025 03:42:22 +0000",
    sizeEstimate: 18282,
    internalDate: "1764128542000",
    isUnread: true,
    isStarred: false,
    hasAttachment: false,
  },
  {
    id: "19abe40f89198c0f",
    threadId: "19abe40f89198c0f",
    labelIds: ["UNREAD", "CATEGORY_UPDATES", "INBOX"],
    snippet:
      "Jira subscription moved to Free plan Atlassian You are now on the Free plan of Jira Hi, We were unable to generate an invoice for your Jira Premium subscription (075a8fd9-f205-31a5-8382-baecb262f24a)",
    subject: "Jira subscription moved to Free plan",
    from: "Atlassian <no_reply@am.atlassian.com>",
    to: "anhkhoa06052004@gmail.com",
    date: "Wed, 26 Nov 2025 03:41:59 +0000",
    sizeEstimate: 16071,
    internalDate: "1764128519000",
    isUnread: true,
    isStarred: false,
    hasAttachment: false,
  },
  {
    id: "19abbacc4d99a7a4",
    threadId: "19abbacc4d99a7a4",
    labelIds: ["UNREAD", "IMPORTANT", "CATEGORY_UPDATES", "INBOX"],
    snippet:
      "Please verify your identity, AnhKhoaDT Here is your GitHub sudo authentication code: 82334060 This code is valid for 15 minutes and can only be used once. Please don&#39;t share this code with anyone:",
    subject: "[GitHub] Sudo email verification code",
    from: "GitHub <noreply@github.com>",
    to: "AnhKhoaDT <anhkhoa06052004@gmail.com>",
    date: "Tue, 25 Nov 2025 07:40:52 -0800",
    sizeEstimate: 27959,
    internalDate: "1764085252000",
    isUnread: true,
    isStarred: false,
    hasAttachment: false,
  },
  {
    id: "19aba6e5873a9087",
    threadId: "19aba6e5873a9087",
    labelIds: ["UNREAD", "CATEGORY_UPDATES", "INBOX"],
    snippet:
      "Nguyễn Nhân 1 made an update DoAnTotNghiep / KAN-26 API for measurement &amp; threshold Nguyễn Nhân 04:49 PM Vietnam Time Summary : API for measurement with alert API for measurement &amp; threshold",
    subject: "[JIRA] (KAN-26) API for measurement & threshold",
    from: '"Nguyễn Nhân (Jira)" <jira@anhkhoa06052004.atlassian.net>',
    to: '"Trần Anh Khoa" <anhkhoa06052004@gmail.com>',
    date: "Tue, 25 Nov 2025 09:53:04 +0000",
    sizeEstimate: 14773,
    internalDate: "1764064384000",
    isUnread: true,
    isStarred: false,
    hasAttachment: false,
  },
  {
    id: "19aaef8a879cf541",
    threadId: "19aaef8a879cf541",
    labelIds: ["UNREAD", "CATEGORY_UPDATES", "INBOX"],
    snippet:
      "Your subscription will be deactivated soon Atlassian Your subscription will be deactivated soon Hi, It&#39;s OK, we all get busy! You still have time to add payment details before your subscription is",
    subject: "Your subscription will be deactivated soon",
    from: "Atlassian <no_reply@am.atlassian.com>",
    to: "anhkhoa06052004@gmail.com",
    date: "Sun, 23 Nov 2025 04:28:42 +0000",
    sizeEstimate: 15737,
    internalDate: "1763872122000",
    isUnread: true,
    isStarred: false,
    hasAttachment: false,
  },
  {
    id: "19aa9a786f91f6ef",
    threadId: "19aa9a786f91f6ef",
    labelIds: ["UNREAD", "CATEGORY_UPDATES", "INBOX"],
    snippet:
      "Last chance: your subscription will be deactivated soon Atlassian This doesn&#39;t have to be goodbye Hi, It&#39;s not too late to keep the work you&#39;ve done so far! This is your last chance to add",
    subject: "Last chance: your subscription will be deactivated soon",
    from: "Atlassian <no_reply@am.atlassian.com>",
    to: "anhkhoa06052004@gmail.com",
    date: "Sat, 22 Nov 2025 03:41:59 +0000",
    sizeEstimate: 17121,
    internalDate: "1763782919000",
    isUnread: true,
    isStarred: false,
    hasAttachment: false,
  },
  {
    id: "19aa72bd9c72f905",
    threadId: "19aa72bd9c72f905",
    labelIds: ["CATEGORY_PROMOTIONS", "UNREAD", "INBOX"],
    snippet:
      "Showcase Get $40 off on LeetCode Annual Premium Subscription. Unlock LeetCode Premium for just $139 - only $11.58/month! Use code &quot;THANKS2025&quot; at checkout. What You Get with LeetCode Premium:",
    subject: "⏳LIMITED TIME OFFER - $40 off Annual Subscription",
    from: "LeetCode <no-reply@leetcode.com>",
    to: "anhkhoa06052004@gmail.com",
    date: "Fri, 21 Nov 2025 16:07:39 +0000",
    sizeEstimate: 25353,
    internalDate: "1763741259000",
    isUnread: true,
    isStarred: false,
    hasAttachment: false,
  },
  {
    id: "19aa336e980e558f",
    threadId: "19aa336e980e558f",
    labelIds: ["CATEGORY_PROMOTIONS", "UNREAD", "INBOX"],
    snippet:
      "Take our Copilot student survey today Student Copilot Usage Survey Share how you REALLY use Copilot! Building projects, vibecoding prototypes, shipping hackathon MVPs? We want your take. Take a quick 5",
    subject: "Share how you REALLY use Copilot!",
    from: "GitHub Education <githubeducation@github.com>",
    to: "anhkhoa06052004@gmail.com",
    date: "Thu, 20 Nov 2025 21:41:14 +0000 (UTC)",
    sizeEstimate: 51934,
    internalDate: "1763674874000",
    isUnread: true,
    isStarred: false,
    hasAttachment: false,
  },
  {
    id: "19a9efffecf4f4ad",
    threadId: "19a9efffecf4f4ad",
    labelIds: ["CATEGORY_PROMOTIONS", "UNREAD", "INBOX"],
    snippet:
      "Unleash the full power of your data—register for our final “Intro to MongoDB” webinar. Intro to MongoDB 3-Part Webinar series Hi Khoa, Ready to take your MongoDB skills to the next level? As your data",
    subject:
      'Master Your Data: Join our "Intro to Queries and Aggregation" webinar!',
    from: "MongoDB <mongodbteam@messages.mongodb.com>",
    to: "anhkhoa06052004@gmail.com",
    date: "Wed, 19 Nov 2025 20:02:24 -0600 (CST)",
    sizeEstimate: 32372,
    internalDate: "1763604144000",
    isUnread: true,
    isStarred: false,
    hasAttachment: false,
  },
  {
    id: "19a9ca6ddc225607",
    threadId: "19a9ca6ddc225607",
    labelIds: ["UNREAD", "IMPORTANT", "CATEGORY_UPDATES", "INBOX"],
    snippet:
      "Please verify your identity, AnhKhoaDT Here is your GitHub sudo authentication code: 90295698 This code is valid for 15 minutes and can only be used once. Please don&#39;t share this code with anyone:",
    subject: "[GitHub] Sudo email verification code",
    from: "GitHub <noreply@github.com>",
    to: "AnhKhoaDT <anhkhoa06052004@gmail.com>",
    date: "Wed, 19 Nov 2025 07:06:12 -0800",
    sizeEstimate: 27958,
    internalDate: "1763564772000",
    isUnread: true,
    isStarred: false,
    hasAttachment: false,
  },
  {
    id: "19a9bbdc9aaf05bc",
    threadId: "19a2fa50c87a3ed4",
    labelIds: ["CATEGORY_PERSONAL", "INBOX"],
    snippet:
      "Nguyễn Nhân 1 made an update DoAnTotNghiep / KAN-6 [BE] - feature authentication for user Nguyễn Nhân 05:48 PM Vietnam Time Resolution : Done Status : In Progress Done View work item Open the work item",
    subject: "[JIRA] (KAN-6) [BE] - feature authentication for user",
    from: '"Nguyễn Nhân (Jira)" <jira@anhkhoa06052004.atlassian.net>',
    to: '"Trần Anh Khoa" <anhkhoa06052004@gmail.com>',
    date: "Wed, 19 Nov 2025 10:51:37 +0000",
    sizeEstimate: 15063,
    internalDate: "1763549497000",
    isUnread: false,
    isStarred: false,
    hasAttachment: false,
  },
  {
    id: "19a9a34711cc72c1",
    threadId: "19a9a34711cc72c1",
    labelIds: ["UNREAD", "CATEGORY_UPDATES", "INBOX"],
    snippet:
      "Your subscription will be deactivated soon Atlassian Your subscription will be deactivated soon Hi, It&#39;s OK, we all get busy! You still have time to add payment details before your subscription is",
    subject: "Your subscription will be deactivated soon",
    from: "Atlassian <no_reply@am.atlassian.com>",
    to: "anhkhoa06052004@gmail.com",
    date: "Wed, 19 Nov 2025 03:41:58 +0000",
    sizeEstimate: 15737,
    internalDate: "1763523718000",
    isUnread: true,
    isStarred: false,
    hasAttachment: false,
  },
  {
    id: "19a98fbc493e0510",
    threadId: "19a98fbc493e0510",
    labelIds: ["UNREAD", "CATEGORY_UPDATES", "INBOX"],
    snippet:
      "Secrets for Traffic Policy is GA, our AI gateway nears early access, and we&#39;re here to help you migrate from ingress-nginx. View in browser ngrok-white-med Hi, AnhKhoaDT! This month is very much",
    subject:
      "[ngrok news] Secrets for Traffic Policy, now GA + ngrok.ai is almost here",
    from: '"Joel @ ngrok" <team@m.ngrok.com>',
    to: "anhkhoa06052004@gmail.com",
    date: "Tue, 18 Nov 2025 14:00:02 -0800",
    sizeEstimate: 101095,
    internalDate: "1763503202000",
    isUnread: true,
    isStarred: false,
    hasAttachment: false,
  },
  {
    id: "19a92fa02200d8f4",
    threadId: "19a92fa02200d8f4",
    labelIds: ["UNREAD", "CATEGORY_UPDATES", "INBOX"],
    snippet:
      "You get a lot of features in your free plan and you&#39;re not using them… yet! View in browser Hey AnhKhoaDT, it&#39;s been a while since you signed up for ngrok, and we noticed you haven&#39;t spun",
    subject: "Still waiting to set up your first endpoint?",
    from: "ngrok team <team@m.ngrok.com>",
    to: "anhkhoa06052004@gmail.com",
    date: "Mon, 17 Nov 2025 10:00:17 -0800",
    sizeEstimate: 43961,
    internalDate: "1763402417000",
    isUnread: true,
    isStarred: false,
    hasAttachment: false,
  },
  {
    id: "19a9012815b82d91",
    threadId: "19a9012815b82d91",
    labelIds: ["UNREAD", "CATEGORY_UPDATES", "INBOX"],
    snippet:
      "Add payment details to keep your subscription Atlassian Add payment details to keep your subscription Hi, We couldn&#39;t process payment for your subscription because we don&#39;t have your payment",
    subject: "Add payment details to keep your subscription",
    from: "Atlassian <no_reply@am.atlassian.com>",
    to: "anhkhoa06052004@gmail.com",
    date: "Mon, 17 Nov 2025 04:28:42 +0000",
    sizeEstimate: 15721,
    internalDate: "1763353722000",
    isUnread: true,
    isStarred: false,
    hasAttachment: false,
  },
  {
    id: "19a8d1eddf09083d",
    threadId: "19a8d1eddf09083d",
    labelIds: ["CATEGORY_PROMOTIONS", "UNREAD", "INBOX"],
    snippet:
      "Work smarter, not harder Unlock the power of AI‑powered service You&#39;ve covered the essentials in Service Collection – now let&#39;s look at some more advanced ways to manage resources and use AI to",
    subject: "Discover more in Service Collection",
    from: "Atlassian <info@e.atlassian.com>",
    to: "<anhkhoa06052004@gmail.com>",
    date: "Sun, 16 Nov 2025 08:43:20 -0600",
    sizeEstimate: 35402,
    internalDate: "1763304200000",
    isUnread: true,
    isStarred: false,
    hasAttachment: false,
  },
  {
    id: "19a87e99be07823e",
    threadId: "19a87e99be07823e",
    labelIds: ["UNREAD", "IMPORTANT", "CATEGORY_UPDATES", "INBOX"],
    snippet:
      "Please verify your identity, AnhKhoaDT Here is your GitHub sudo authentication code: 78939999 This code is valid for 15 minutes and can only be used once. Please don&#39;t share this code with anyone:",
    subject: "[GitHub] Sudo email verification code",
    from: "GitHub <noreply@github.com>",
    to: "AnhKhoaDT <anhkhoa06052004@gmail.com>",
    date: "Sat, 15 Nov 2025 06:27:04 -0800",
    sizeEstimate: 27920,
    internalDate: "1763216824000",
    isUnread: true,
    isStarred: false,
    hasAttachment: false,
  },
  {
    id: "19a7c1d7c11298a1",
    threadId: "19a7c1d7c11298a1",
    labelIds: ["UNREAD", "CATEGORY_UPDATES", "INBOX"],
    snippet:
      "Atlassian Let&#39;s make it official Hi Trần, We hope you&#39;re enjoying your Jira Premium trial. Heads up — your trial ends on November 16, 2025. What do I need to do? If you want to continue with",
    subject: "Add payment details before Jira Premium trial ends",
    from: "Atlassian <noreply@po.atlassian.net>",
    to: '"Trần Anh Khoa" <anhkhoa06052004@gmail.com>',
    date: "Thu, 13 Nov 2025 07:28:18 +0000",
    sizeEstimate: 19853,
    internalDate: "1763018898000",
    isUnread: true,
    isStarred: false,
    hasAttachment: false,
  },
  {
    id: "19a7bf8a3dc655b9",
    threadId: "19a7b9ba030b2ad8",
    labelIds: ["UNREAD", "CATEGORY_PERSONAL", "INBOX"],
    snippet:
      "Render We encountered an error during the deploy process for my-app:latest. This means your deploy didn&#39;t complete successfully and your latest changes may not be live. Image version: latest@",
    subject: "deploy failed for my-app:latest",
    from: "Render <no-reply@render.com>",
    to: "anhkhoa06052004@gmail.com",
    date: "Thu, 13 Nov 2025 06:48:02 +0000",
    sizeEstimate: 17477,
    internalDate: "1763016482000",
    isUnread: true,
    isStarred: false,
    hasAttachment: false,
  },
];

```

### types\auth.types.ts
```ts
export interface User {
    id: string;
    email: string;
    name?: string;
    createdAt: string;
}

export interface LoginCredentials {
    email: string;
    password: string;
}

export interface RegisterCredentials extends LoginCredentials {
    birthday?: Date,
    name?: string;
}

export interface LoginResponse {
    user: User;
    accessToken: string;
    refreshToken: string;
}

export interface RefreshTokenResponse {
    accessToken: string;
}

export interface AuthState {
    user: User | null;
    isAuthenticated: boolean;
    isLoading: boolean;
}

```

### types\index.ts
```ts
// file: types/index.ts

export interface User {
  name: string;
  email: string;
  avatar: string; // Sửa lỗi chính tả avartar -> avatar
}

// Đổi tên MailList thành Mail để dùng chung cho cả app
export interface Mail {
  id: string;
  threadId: string; // Thêm trường này vì MockData có
  labelIds: string[]; // Thêm trường này
  snippet: string; // Thêm trường này (quan trọng cho MailContent)

  from: string;
  to: string;
  subject: string;
  date: string;

  // Nội dung mail có thể là body hoặc htmlBody tùy nguồn dữ liệu
  // Để optional (?) để linh hoạt
  body?: string;
  htmlBody?: string;
  textBody?: string;

  isUnread: boolean;
  isStarred: boolean;
  hasAttachment?: boolean;
}

export interface Header {
  name: string;
  value: string;
}

export interface Body {
  size: number;
  data?: string; // Trường này có thể không tồn tại ở level cao nhất hoặc chứa base64 string
}

export interface Payload {
  partId: string;
  mimeType: string;
  filename: string;
  headers: Header[];
  body: Body;
  parts?: Payload[]; // Cấu trúc đệ quy: một phần (part) có thể chứa nhiều phần con
}

export interface RawMessage {
  id: string;
  threadId: string;
  labelIds: string[];
  snippet: string;
  payload: Payload;
}

export interface EmailData {
  id: string;
  threadId: string;
  labelIds: string[];
  snippet: string;
  subject: string;
  from: string;
  to: string;
  cc: string;
  bcc: string;
  date: string;
  messageId: string;
  htmlBody: string;
  textBody: string;
  attachments: any[]; // Mảng rỗng trong data mẫu, thường sẽ là object chứa attachmentId
  sizeEstimate: number;
  historyId: string;
  internalDate: string; // Lưu ý: Trong JSON là chuỗi (string), dù giá trị giống số
  raw: RawMessage;
}

export interface NavItem {
  title: string;
  path: string;
  // input className
  icon: React.ComponentType<{ className?: string }>;
  isActive?: boolean;
}

export interface Label {
  id: string;
  name: string;
  color: string;
}

```

### utils\MailClassify.ts
```ts

```
